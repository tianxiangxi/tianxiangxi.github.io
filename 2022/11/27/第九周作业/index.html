

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="[TOC] 一、nginx实现全栈SSL。要求http rewrite到https协议。1.1、自签名证书12345678910111213141516171819[root@server ~]#cd &#x2F;apps&#x2F;nginx[root@server nginx]#mkdir certs              #创建存放证书路径[root@server nginx]#cd certs&#x2F;[root">
<meta property="og:type" content="article">
<meta property="og:title" content="第九周作业">
<meta property="og:url" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/index.html">
<meta property="og:site_name" content="5-12 23:30">
<meta property="og:description" content="[TOC] 一、nginx实现全栈SSL。要求http rewrite到https协议。1.1、自签名证书12345678910111213141516171819[root@server ~]#cd &#x2F;apps&#x2F;nginx[root@server nginx]#mkdir certs              #创建存放证书路径[root@server nginx]#cd certs&#x2F;[root">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129100238035.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129102221700.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129113103417.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129113829880.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129121035588.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129122222689.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/第九周作业/image-20221129152150302.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129155214696.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129155953866.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129162918630.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129162949414.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129163014899.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129165521812.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221130154931353.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221130173134603.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221130173336671.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221130183021629.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221130183130306.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221130183154802.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201130318586.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201130505437.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201170207670.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201173556242.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201173734350.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202090518852.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201180305733.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201180521002.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201181249048.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201181034200.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201181526636.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201181844951.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201182211875.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201182544795.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201182843812.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201183120445.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201183341015.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201183910518.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201184417858.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201184535208.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201184718588.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201184932906.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201185653371.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201185502685.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201185607673.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201185948662.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201190140452.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201193905625.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201194235233.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201194506992.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201194825919.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201195123403.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201195449263.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201195827167.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221201200002381.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202091339692.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202093100290.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221203124240190.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221203124653941.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221203133648027.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202143633554.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202144619511.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202144804984.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202144839440.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202144901645.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202145157542.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202145536310.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202184926676.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202185333822.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202185406445.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202192222020.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202194512169.png">
<meta property="og:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221202194551409.png">
<meta property="article:published_time" content="2022-11-27T10:17:20.000Z">
<meta property="article:modified_time" content="2022-12-18T04:04:09.283Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="nginx  tomcat  jumpserver">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2022/11/27/%E7%AC%AC%E4%B9%9D%E5%91%A8%E4%BD%9C%E4%B8%9A/image-20221129100238035.png">
  
  
  <title>第九周作业 - 5-12 23:30</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="第九周作业">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-11-27 10:17" pubdate>
        November 27, 2022 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      48k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      402 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">第九周作业</h1>
            
            <div class="markdown-body">
              <p>[TOC]</p>
<h3 id="一、nginx实现全栈SSL。要求http-rewrite到https协议。"><a href="#一、nginx实现全栈SSL。要求http-rewrite到https协议。" class="headerlink" title="一、nginx实现全栈SSL。要求http rewrite到https协议。"></a>一、nginx实现全栈SSL。要求http rewrite到https协议。</h3><h4 id="1-1、自签名证书"><a href="#1-1、自签名证书" class="headerlink" title="1.1、自签名证书"></a>1.1、自签名证书</h4><figure class="highlight sh"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><pre><code class="hljs sh">[root@server ~]<span class="hljs-comment">#cd /apps/nginx</span><br>[root@server nginx]<span class="hljs-comment">#mkdir certs              #创建存放证书路径</span><br>[root@server nginx]<span class="hljs-comment">#cd certs/</span><br>[root@server certs]<span class="hljs-comment">#openssl req -newkey rsa:4096 -nodes -sha256 -keyout www.magedu.org.key -x509 -days 3650 -out www.magedu.org.crt</span><br>Country Name (2 letter code) [XX]:CN      <span class="hljs-comment">#国家</span><br>State or Province Name (full name) []:beijing     <span class="hljs-comment">#省</span><br>Locality Name (eg, city) [Default City]:beijing   <span class="hljs-comment">#市</span><br>Organization Name (eg, company) [Default Company Ltd]:magedu   <span class="hljs-comment">#公司</span><br>Organizational Unit Name (eg, section) []:it      <span class="hljs-comment">#部门</span><br>Common Name (eg, your name or your server<span class="hljs-string">&#x27;s hostname) []:*.magedu.org  #网站</span><br><span class="hljs-string">Email Address []:</span><br><span class="hljs-string">#*.magedu.org使用的是泛域名，也可以指定具体网站</span><br><span class="hljs-string">[root@server certs]#ls</span><br><span class="hljs-string">www.magedu.org.crt  www.magedu.org.key</span><br><span class="hljs-string"></span><br><span class="hljs-string">#查看证书文件</span><br><span class="hljs-string">[root@server certs]#openssl x509 -in www.magedu.org.crt -noout -text</span><br><span class="hljs-string">#或者下载到windows上查看</span><br><span class="hljs-string">[root@server certs]#sz www.magedu.org.crt</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129100238035.png" srcset="/img/loading.gif" lazyload alt="image-20221129100238035"></a></p>
<h4 id="1-2、https配置"><a href="#1-2、https配置" class="headerlink" title="1.2、https配置"></a>1.2、https配置</h4><p>nginx 的https 功能基于模块ngx_http_ssl_module实现，因此如果是编译安装的nginx要使用参数</p>
<p>ngx_http_ssl_module开启ssl功能，但是作为nginx的核心功能，yum安装的nginx默认就是开启的，编</p>
<p>译安装的nginx需要指定编译参数–with-http_ssl_module开启</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/en/</span>docs<span class="hljs-regexp">/http/</span>ngx_http_ssl_module.html<br></code></pre></td></tr></table></figure>

<p>配置参数如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssl on | off;   <br><span class="hljs-comment">#为指定的虚拟主机配置是否启用ssl功能，此功能在1.15.0废弃，使用listen [ssl]替代</span><br>listen 443 ssl;<br><br>ssl_certificate /path/to/file;<br><span class="hljs-comment">#指向包含当前虚拟主机和CA的两个证书信息的文件，一般是crt文件</span><br>ssl_certificate_key /path/to/file;<br><span class="hljs-comment">#当前虚拟主机使用的私钥文件，一般是key文件</span><br><br>ssl_protocols [SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2]; <br><span class="hljs-comment">#支持ssl协议版本，早期为ssl现在是TLS，默认为后三个</span><br><br>ssl_session_cache off | none | [<span class="hljs-built_in">builtin</span>[:size]] [shared:name:size];<br><span class="hljs-comment">#配置ssl缓存</span><br>                off： <span class="hljs-comment">#关闭缓存</span><br>               none:  <span class="hljs-comment">#通知客户端支持ssl session cache，但实际不支持</span><br>     <span class="hljs-built_in">builtin</span>[:size]：<span class="hljs-comment">#使用OpenSSL内建缓存，为每worker进程私有</span><br> [shared:name:size]：<span class="hljs-comment">#在各worker之间使用一个共享的缓存，需要定义一个缓存名称和缓存空间大小，一兆可以存储4000个会话信息，多个虚拟主机可以使用相同的缓存名称</span><br> <br>ssl_session_timeout time;<br><span class="hljs-comment">#客户端连接可以复用ssl session cache中缓存的有效时长，默认5m</span><br></code></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#查看编译安装时是否安装此模块，已安装</span><br>[root@server certs]<span class="hljs-comment">#nginx -V</span><br>nginx version: nginx/1.20.2<br>built by gcc 8.5.0 20210514 (Red Hat 8.5.0-10) (GCC) <br>built with OpenSSL 1.1.1k  FIPS 25 Mar 2021<br>TLS SNI support enabled<br>configure arguments: --prefix=/apps/nginx --user=nginx --group=nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream --with-stream_ssl_module --with-stream_realip_module --add-module=/usr/local/src/echo-nginx-module-0.63<br>[root@server certs]<span class="hljs-comment">#cd ..</span><br>[root@server nginx]<span class="hljs-comment">#cd conf.d</span><br>[root@server conf.d]<span class="hljs-comment">#vim pc.conf</span><br>server &#123;<br>   ......<br>   listen 443 ssl;<br>   ssl_certificate /apps/nginx/certs/www.magedu.org.crt;<br>   ssl_certificate_key /apps/nginx/certs/www.magedu.org.key;<br>   ssl_session_cache shared:sslcache:20m;<br>   ssl_session_timeout 10m;<br>   ......<br>&#125;<br>:wq<br>[root@server conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@server conf.d]<span class="hljs-comment">#nginx -s reload</span><br>[root@server conf.d]<span class="hljs-comment">#ss -ntl                #443端口已打开</span><br>State    Recv-Q    Send-Q     Local Address:Port     Peer Address:Port    Process   <br>LISTEN    0        128         0.0.0.0:80              0.0.0.0:*                     <br>LISTEN    0        128         0.0.0.0:22              0.0.0.0:*                     <br>LISTEN    0        128         0.0.0.0:443             0.0.0.0:*                     <br>LISTEN    0        128         [::]:22                 [::]:*  <br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129102221700.png" srcset="/img/loading.gif" lazyload alt="image-20221129102221700"></a></p>
<h4 id="1-3、实现HSTS"><a href="#1-3、实现HSTS" class="headerlink" title="1.3、实现HSTS"></a>1.3、实现HSTS</h4><p>官方文档:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ABAP">https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/<br></code></pre></td></tr></table></figure>

<p><strong>注意：配置rewrite才能实现http跳转到https</strong></p>
<p>Nginx服务器利用 ngx_http_rewrite_module 模块（属于标准模块，系统默认安装）解析和处理rewrite请求，此功能依靠 PCRE(perl compatible regular expression)，因此编译之前要安装PCRE库，rewrite是nginx服务器的重要功能之一，用于实现URL的重写，URL的重写是非常有用的功能，比如它可以在我们改变网站结构之后，不需要客户端修改原来的书签，也无需其他网站修改我们的链接，就可以设置为访问，另外还可以在一定程度上提高网站的安全性。</p>
<p>rewrite官方文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ABAP">https://nginx.org/en/docs/http/ngx_http_rewrite_module.html<br></code></pre></td></tr></table></figure>

<h5 id="1-3-1、利用return实现http跳转到https"><a href="#1-3-1、利用return实现http跳转到https" class="headerlink" title="1.3.1、利用return实现http跳转到https"></a>1.3.1、利用return实现http跳转到https</h5><p>return适用于server、location、if</p>
<h6 id="1-3-1-1、用两个虚拟主机分开实现跳转"><a href="#1-3-1-1、用两个虚拟主机分开实现跳转" class="headerlink" title="1.3.1.1、用两个虚拟主机分开实现跳转"></a>1.3.1.1、用两个虚拟主机分开实现跳转</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@server conf.d]<span class="hljs-comment">#vim pc.conf</span><br>server &#123;<br>   listen 80;<br>   server_name www.magedu.org;<br>   root /data/nginx/html/pc;<br>   <span class="hljs-built_in">return</span> 302 https://www.magedu.org/;<br>&#125;<br>server &#123;<br>   listen 443 ssl;<br>   ssl_certificate /apps/nginx/certs/www.magedu.org.crt;<br>   ssl_certificate_key /apps/nginx/certs/www.magedu.org.key;<br>   ssl_session_cache shared:sslcache:20m;<br>   ssl_session_timeout 10m;<br>   server_name www.magedu.org;<br>   root /data/nginx/html/pc;<br>   .....<br>&#125;<br>:wq<br>[root@server conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@server conf.d]<span class="hljs-comment">#nginx -s reload</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129113103417.png" srcset="/img/loading.gif" lazyload alt="image-20221129113103417"></a></p>
<h6 id="1-3-1-2、用一个虚拟主机实现跳转"><a href="#1-3-1-2、用一个虚拟主机实现跳转" class="headerlink" title="1.3.1.2、用一个虚拟主机实现跳转"></a>1.3.1.2、用一个虚拟主机实现跳转</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@server conf.d]<span class="hljs-comment">#vim pc.conf</span><br>server &#123;<br>   listen 80;<br>   listen 443 ssl;<br>   ssl_certificate /apps/nginx/certs/www.magedu.org.crt;<br>   ssl_certificate_key /apps/nginx/certs/www.magedu.org.key;<br>   ssl_session_cache shared:sslcache:20m;<br>   ssl_session_timeout 10m;<br>   server_name www.magedu.org;<br>   root /data/nginx/html/pc;<br>   <span class="hljs-keyword">if</span>(<span class="hljs-variable">$scheme</span> = http) &#123;<br>        <span class="hljs-built_in">return</span> 302 https://www.magedu.org/;<br>   &#125;<br>:wq<br>[root@server conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@server conf.d]<span class="hljs-comment">#nginx -s reload</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129113829880.png" srcset="/img/loading.gif" lazyload alt="image-20221129113829880"></a></p>
<h5 id="1-3-2、利用rewrite实现http跳转到https"><a href="#1-3-2、利用rewrite实现http跳转到https" class="headerlink" title="1.3.2、利用rewrite实现http跳转到https"></a>1.3.2、利用rewrite实现http跳转到https</h5><p>rewrite 格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">Syntax: rewrite regex replacement [flag]; <span class="hljs-comment">#通过正则表达式处理用户请求并返回替换后的数据包。</span><br>Default: —<br>Context: server, location, <span class="hljs-keyword">if</span><br></code></pre></td></tr></table></figure>

<p>flag 说明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">redirect;<br><span class="hljs-comment">#临时重定向，重写完成后以临时重定向方式直接返回重写后生成的新URL给客户端，由客户端重新发起请求;</span><br>使用相对路径,或者http://或https://开头，状态码：302<br>permanent;<br><span class="hljs-comment">#重写完成后以永久重定向方式直接返回重写后生成的新URL给客户端，由客户端重新发起请求，状态码：301</span><br><span class="hljs-built_in">break</span>;<br><span class="hljs-comment">#重写完成后,停止对当前URL在当前location中后续的其它重写操作，而后直接跳转至重写规则配置块之后</span><br>的其它配置;结束循环，建议在location中使用<br><span class="hljs-comment">#适用于一个URL一次重写</span><br>last;<br><span class="hljs-comment">#重写完成后,停止对当前URI在当前location中后续的其它重写操作，而后对新的URL启动新一轮重写检查，</span><br>不建议在location中使用<br><span class="hljs-comment">#适用于一个URL多次重写，要注意避免出现超过十次以及URL重写后返回错误的给用户</span><br></code></pre></td></tr></table></figure>

<h6 id="1-3-2-1、用两个虚拟主机分开实现跳转"><a href="#1-3-2-1、用两个虚拟主机分开实现跳转" class="headerlink" title="1.3.2.1、用两个虚拟主机分开实现跳转"></a>1.3.2.1、用两个虚拟主机分开实现跳转</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@server conf.d]<span class="hljs-comment">#vim pc.conf</span><br>server &#123;<br>   listen 80;<br>   server_name www.magedu.org;<br>   root /data/nginx/html/pc;<br>   rewrite ^(.*)$ https://$host<span class="hljs-variable">$1</span> redirect;<br>&#125;<br>server &#123;<br>   listen 443 ssl;<br>   ssl_certificate /apps/nginx/certs/www.magedu.org.crt;<br>   ssl_certificate_key /apps/nginx/certs/www.magedu.org.key;<br>   ssl_session_cache shared:sslcache:20m;<br>   ssl_session_timeout 10m;<br>   server_name www.magedu.org;<br>   root /data/nginx/html/pc;<br>   .....<br>&#125;<br>:wq<br>[root@server conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@server conf.d]<span class="hljs-comment">#nginx -s reload</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129121035588.png" srcset="/img/loading.gif" lazyload alt="image-20221129121035588"></a></p>
<h6 id="1-3-1-2、用一个虚拟主机实现跳转-1"><a href="#1-3-1-2、用一个虚拟主机实现跳转-1" class="headerlink" title="1.3.1.2、用一个虚拟主机实现跳转"></a>1.3.1.2、用一个虚拟主机实现跳转</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@server conf.d]<span class="hljs-comment">#vim pc.conf</span><br>server &#123;<br>   listen 80;<br>   listen 443 ssl;<br>   ssl_certificate /apps/nginx/certs/www.magedu.org.crt;<br>   ssl_certificate_key /apps/nginx/certs/www.magedu.org.key;<br>   ssl_session_cache shared:sslcache:20m;<br>   ssl_session_timeout 10m;<br>   server_name www.magedu.org;<br>   root /data/nginx/html/pc;<br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$scheme</span> = http) &#123;<br>        rewrite ^(.*)$ https://$host<span class="hljs-variable">$1</span> redirect;<br>   &#125;                        <span class="hljs-comment">#针对全网站跳转</span><br>   .....<br>&#125;<br>:wq<br><br><span class="hljs-comment">#实现网站里面只有各别页面http转换为https</span><br>location /about &#123;<br>      <span class="hljs-built_in">alias</span> /opt/pc/about;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">$scheme</span> = http) &#123;<br>        rewrite / https://<span class="hljs-variable">$host</span>/about redirect;<br>      &#125;<br>&#125;<br><br>[root@server conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@server conf.d]<span class="hljs-comment">#nginx -s reload</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129122222689.png" srcset="/img/loading.gif" lazyload alt="image-20221129122222689"></a></p>
<h3 id="二、nginx实现动静分离。"><a href="#二、nginx实现动静分离。" class="headerlink" title="二、nginx实现动静分离。"></a>二、nginx实现动静分离。</h3><p><a href=""><img src="第九周作业/image-20221129152150302.png" srcset="/img/loading.gif" lazyload alt="image-20221129152150302" style="zoom:50%;" /></a></p>
<h4 id="2-1、架构组成"><a href="#2-1、架构组成" class="headerlink" title="2.1、架构组成"></a>2.1、架构组成</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ABAP">反向代理服务器：10.0.0.184   proxy<br>后端服务器：10.0.0.185      server01      存放静态资源<br>后端服务器：10.0.0.186      server02      存放动态资源<br></code></pre></td></tr></table></figure>

<h4 id="2-2、反向代理服务器配置"><a href="#2-2、反向代理服务器配置" class="headerlink" title="2.2、反向代理服务器配置"></a>2.2、反向代理服务器配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@proxy conf.d]<span class="hljs-comment">#vim pc.conf</span><br>server &#123;<br>   listen 80;<br>   server_name www.magedu.org;<br>   access_log /apps/nginx/logs/access-json-www.magedu.org.log access_json;<br>   root /data/nginx/html/pc;<br>   location ~ \.(jpg|png|gif)$ &#123;<br>        proxy_pass http://10.0.0.185;<br>   &#125;<br>   location /api &#123;<br>        proxy_pass http://10.0.0.186;<br>   &#125;<br>&#125;<br>:wq<br>[root@proxy conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@proxy conf.d]<span class="hljs-comment">#nginx -s reload</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3、后端服务器配置"><a href="#2-3、后端服务器配置" class="headerlink" title="2.3、后端服务器配置"></a>2.3、后端服务器配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@server01 ~]<span class="hljs-comment">#cd /apps/nginx/html</span><br>[root@server01 html]<span class="hljs-comment">#wget -O 1.jpg &quot;https://t7.baidu.com/it/u=4141604674,3317329080&amp;fm=193&amp;f=GIF&quot;   #下载图片并命名1.jpg</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129155214696.png" srcset="/img/loading.gif" lazyload alt="image-20221129155214696"></a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@server02 ~]<span class="hljs-comment">#cd /apps/nginx/html</span><br>[root@server02 html]<span class="hljs-comment">#mkdir api</span><br>[root@server02 html]<span class="hljs-comment">#cd api</span><br>[root@server02 api]<span class="hljs-comment">#vim index.html</span><br>&lt;h1&gt; 10.0.0.186 &lt;/h1&gt;<br>:wq<br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129155953866.png" srcset="/img/loading.gif" lazyload alt="image-20221129155953866"></a></p>
<h3 id="三、nginx实现防盗链功能。"><a href="#三、nginx实现防盗链功能。" class="headerlink" title="三、nginx实现防盗链功能。"></a>三、nginx实现防盗链功能。</h3><p>防盗链基于客户端携带的referer实现，referer是记录打开一个页面之前记录是从哪个页面跳转过来的标</p>
<p>记信息，如果别人只链接了自己网站图片或某个单独的资源，而不是打开了网站的整个页面，这就是盗</p>
<p>链，referer就是之前的那个网站域名，正常的referer信息有以下几种：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">none：<span class="hljs-comment">#请求报文首部没有referer首部，比如用户直接在浏览器输入域名访问web网站，就没有referer信息。</span><br>blocked：<span class="hljs-comment">#请求报文有referer首部，但无有效值，比如为空。</span><br>server_names：<span class="hljs-comment">#referer首部中包含本主机名及即nginx 监听的server_name。</span><br>arbitrary_string：<span class="hljs-comment">#自定义指定字符串，但可使用*作通配符。示例: *.magedu.org www.magedu.*</span><br>regular expression：<span class="hljs-comment">#被指定的正则表达式模式匹配到的字符串,要使用~开头，例如：~.*\.magedu\.com</span><br></code></pre></td></tr></table></figure>

<h4 id="3-1、实现盗链"><a href="#3-1、实现盗链" class="headerlink" title="3.1、实现盗链"></a>3.1、实现盗链</h4><p>在一个web 站点盗链另一个站点的资源信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#在www.magedu.org站点盗取m.magedu.org的图片</span><br>[root@proxy ~]<span class="hljs-comment">#cd /data/nginx/html/pc</span><br>[root@proxy pc]<span class="hljs-comment">#vim daolian.html</span><br>&lt;html&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>&lt;meta http-equiv=Content-Type content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>&lt;title&gt;盗链&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;img src=<span class="hljs-string">&quot;http://m.magedu.org/1.jpg&quot;</span> &gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>:wq<br><br><span class="hljs-comment">#查看m.magedu.org的日志可以看见www.magedu.org的盗图</span><br>[root@proxy conf.d]<span class="hljs-comment">#tail /apps/nginx/logs/access.log</span><br>10.0.0.1 - - [29/Nov/2022:16:30:07 +0800] <span class="hljs-string">&quot;GET /1.jpg HTTP/1.1&quot;</span> 304 0 <span class="hljs-string">&quot;http://www.magedu.org/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.56&quot;</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129162918630.png" srcset="/img/loading.gif" lazyload alt="image-20221129162918630"></a></p>
<p><a href=""><img src="image-20221129162949414.png" srcset="/img/loading.gif" lazyload alt="image-20221129162949414"></a></p>
<p><a href=""><img src="image-20221129163014899.png" srcset="/img/loading.gif" lazyload alt="image-20221129163014899"></a></p>
<h4 id="3-2、实现防盗链"><a href="#3-2、实现防盗链" class="headerlink" title="3.2、实现防盗链"></a>3.2、实现防盗链</h4><p>基于访问安全考虑，nginx支持通过ngx_http_referer_module模块,检查访问请求的referer信息是否有</p>
<p>效实现防盗链功能</p>
<p>官方文档: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ABAP">https://nginx.org/en/docs/http/ngx_http_referer_module.html<br></code></pre></td></tr></table></figure>

<p>语法格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">location   /images &#123;<br>   root /data/nginx/html/pc;<br>   index index.html;<br>   valid_referers none blocked server_names<br>         *.example.com example.* www.example.org/galleries/<br>         ~\.google\.;<br>          <br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$invalid_referer</span>) &#123;<br>     <span class="hljs-built_in">return</span> 403;<br>   &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@proxy conf.d]<span class="hljs-comment">#vim mobile.conf</span><br>server &#123;<br>   listen 80;<br>   server_name m.magedu.org;<br>   location / &#123;<br>   root /data/nginx/html/mobile;<br>   &#125;                                          <span class="hljs-comment">#添加下面几行</span><br>   valid_referers none blocked server_names ~\.google\. ~\.baidu\. ~\.bing\. ~\.so\. ;                     <br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$invalid_referer</span>) &#123;<br>        <span class="hljs-built_in">return</span> 403 <span class="hljs-string">&quot;Forbidden Access&quot;</span>;<br>   &#125;<br>&#125;<br>:wq<br>[root@proxy conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@proxy conf.d]<span class="hljs-comment">#nginx -s reload</span><br><br><span class="hljs-comment">#查看m.magedu.org的日志可以看见403拒绝www.magedu.org的盗图</span><br>[root@proxy conf.d]<span class="hljs-comment">#tail /apps/nginx/logs/access.log       #出现403提示</span><br>10.0.0.1 - - [29/Nov/2022:16:49:52 +0800] <span class="hljs-string">&quot;GET /1.jpg HTTP/1.1&quot;</span> 403 16 <span class="hljs-string">&quot;http://www.magedu.org/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.56&quot;</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221129165521812.png" srcset="/img/loading.gif" lazyload alt="image-20221129165521812"></a></p>
<h3 id="四、解析nginx常见的负载均衡算法。"><a href="#四、解析nginx常见的负载均衡算法。" class="headerlink" title="四、解析nginx常见的负载均衡算法。"></a>四、解析nginx常见的负载均衡算法。</h3><p>Nginx 可以基于ngx_http_upstream_module模块提供服务器分组转发、权重分配、状态监测、调度算法等高级功能</p>
<p>官方文档： <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html">https://nginx.org/en/docs/http/ngx_http_upstream_module.html</a></p>
<h4 id="4-1、负载均衡五种算法"><a href="#4-1、负载均衡五种算法" class="headerlink" title="4.1、负载均衡五种算法"></a>4.1、负载均衡五种算法</h4><p><strong>①轮询（默认）</strong></p>
<p>每个请求按时间顺序逐一分配到不同的后端服务，如果后端某台服务器死机，自动剔除故障系统，使用户访问不受影响。</p>
<p><strong>②weight（轮询权值）</strong></p>
<p>weight的值越大分配到的访问概率越高，主要用于后端每台服务器性能不均衡的情况下。或者仅仅为在主从的情况下设置不同的权值，达到合理有效的地利用主机资源。</p>
<p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<p><strong>③ip_hash</strong></p>
<p>每个请求按访问IP的哈希结果分配，使来自同一个IP的访客固定访问一台后端服务器，并且可以有效解决动态网页存在的session共享问题。</p>
<p>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。</p>
<p><strong>④fair（第三方）</strong></p>
<p>比 weight、ip_hash更加智能的负载均衡算法，fair算法可以根据页面大小和加载时间长短智能地进行负载均衡，也就是根据后端服务器的响应时间 来分配请求，响应时间短的优先分配。Nginx本身不支持fair，如果需要这种调度算法，则必须安装upstream_fair模块。</p>
<p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。<br><strong>⑤url_hash（第三方）</strong></p>
<p>按访问的URL的哈希结果来分配请求，使每个URL定向到一台后端服务器，可以进一步提高后端缓存服务器的效率。Nginx本身不支持url_hash，如果需要这种调度算法，则必须安装Nginx的hash软件包。</p>
<p>按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">hash</span> KEY [consistent];<br><span class="hljs-comment">#基于指定请求报文中首部字段或者URI等key做hash计算，使用consistent参数，将使用ketama一致性hash算法，适用于后端是Cache服务器（如varnish）时使用，consistent定义使用一致性hash运算，一致性hash基于取模运算</span><br><span class="hljs-comment">#示例</span><br><span class="hljs-built_in">hash</span> <span class="hljs-variable">$request_uri</span> consistent; <span class="hljs-comment">#基于用户请求的uri做hash</span><br><span class="hljs-built_in">hash</span> <span class="hljs-variable">$cookie_sessionid</span>  <span class="hljs-comment">#基于cookie中的sessionid这个key进行hash调度,实现会话绑定</span><br></code></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">ip_hash;<br><span class="hljs-comment">#源地址hash调度方法，基于的客户端的remote_addr(源地址IPv4的前24位或整个IPv6地址)做hash计算，以实现会话保持</span><br><span class="hljs-comment">#hash $remote_addr 则是对全部32bit的IPv4进行hash计算</span><br></code></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">least_conn;<br><span class="hljs-comment">#最少连接调度算法，优先将客户端请求调度到当前连接最少的后端服务器,相当于LVS中的WLC</span><br></code></pre></td></tr></table></figure>

<h3 id="五、基于LNMP完成搭建任意一种应用。"><a href="#五、基于LNMP完成搭建任意一种应用。" class="headerlink" title="五、基于LNMP完成搭建任意一种应用。"></a>五、基于LNMP完成搭建任意一种应用。</h3><p><a href=""><img src="image-20221130154931353.png" srcset="/img/loading.gif" lazyload alt="image-20221130154931353"></a></p>
<h4 id="5-1、准备数据库"><a href="#5-1、准备数据库" class="headerlink" title="5.1、准备数据库"></a>5.1、准备数据库</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@Rocky ~]<span class="hljs-comment">#yum -y install mysql-server redis</span><br>[root@Rocky ~]<span class="hljs-comment">#systemctl enable --now mysqld redis</span><br>[root@Rocky ~]<span class="hljs-comment">#mysql</span><br>mysql&gt; create database kodbox;<br>mysql&gt; create user kodbox@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>mysql&gt; grant all on kodbox.* to kodbox@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br><br><span class="hljs-comment">#修改redis配置文件</span><br>[root@Rocky ~]<span class="hljs-comment">#vim /etc/redis.conf</span><br><span class="hljs-built_in">bind</span> 0.0.0.0                <span class="hljs-comment">#将127.0.0.1改为0.0.0.0</span><br>[root@Rocky ~]<span class="hljs-comment">#systemctl restart redis</span><br></code></pre></td></tr></table></figure>

<h4 id="5-2、nginx的配置"><a href="#5-2、nginx的配置" class="headerlink" title="5.2、nginx的配置"></a>5.2、nginx的配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#nginx的配置</span><br>[root@proxy ~]<span class="hljs-comment">#yum -y install nginx      #前期已编译安装nginx了，不再执行此步</span><br>[root@proxy ~]<span class="hljs-comment">#vim /apps/nginx/conf/nginx.conf</span><br>include /apps/nginx/conf.d/*.conf;       <span class="hljs-comment">#在倒数第二行添加此命令</span><br>[root@proxy ~]<span class="hljs-comment">#cd /apps/nginx/conf.d</span><br>[root@proxy ~]<span class="hljs-comment">#mkdir -p /data/nginx/kodbox       #创建文件存放路径</span><br>[root@proxy conf.d]<span class="hljs-comment">#vim kodbox.conf</span><br>server &#123;<br>     listen 80;<br>     server_name kodbox.magedu.org;<br>     root /data/nginx/kodbox;             <span class="hljs-comment">#文件存放路径</span><br>     client_max_body_size 200M;           <span class="hljs-comment">#文件上传大小限制</span><br>     index index.php;<br>     location ~ \.php$ &#123;<br>          root            /data/nginx/kodbox;<br>          fastcgi_pass    127.0.0.1:9000;<br>          fastcgi_index   index.php<br>          fastcgi_param   SCRIPT_FILENAME   $document_root<span class="hljs-variable">$fastcgi_script_name</span>;<br>          include         fastcgi_params;<br>     &#125;<br>     location ~ ^/(ping|fpm_status)$ &#123;<br>       fastcgi_pass   127.0.0.1:9000;<br>       fastcgi_param  PATH_TRANSLATED $document_root<span class="hljs-variable">$fastcgi_script_name</span>;<br>       include fastcgi_params;<br>     &#125;<br>&#125;<br>:wq<br>[root@proxy conf.d]<span class="hljs-comment">#nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br>[root@proxy conf.d]<span class="hljs-comment">#nginx -s reload</span><br></code></pre></td></tr></table></figure>

<h4 id="5-3、安装和配置php"><a href="#5-3、安装和配置php" class="headerlink" title="5.3、安装和配置php"></a>5.3、安装和配置php</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装PHP相关软件包</span><br>[root@proxy ~]<span class="hljs-comment">#yum -y install php-fpm php-json php-mysqlnd php-mbstring php-xml php-gd</span><br>[root@proxy ~]<span class="hljs-comment">#vim /etc/php.ini</span><br>; Maximum allowed size <span class="hljs-keyword">for</span> uploaded files.<br>; http://php.net/upload-max-filesize<br>upload_max_filesize = 200M                 <span class="hljs-comment">#由2改为200，调大上传限制</span><br>; http://php.net/post-max-size<br>post_max_size = 200M                       <span class="hljs-comment">#由8改为200，调大上传限制</span><br>:wq<br>[root@proxy ~]<span class="hljs-comment">#vim /etc/php-fpm.d/www.conf </span><br>; RPM: apache user chosen to provide access to the same directories as httpd<br>user = nginx                       <span class="hljs-comment">#将Apache改为nginx</span><br>; RPM: Keep a group allowed to write <span class="hljs-keyword">in</span> <span class="hljs-built_in">log</span> <span class="hljs-built_in">dir</span>.<br>group = nginx                      <span class="hljs-comment">#将Apache改为nginx</span><br>; listen = /run/php-fpm/www.sock   <span class="hljs-comment">#将此行注释</span><br>listen = 127.0.0.1:9000            <span class="hljs-comment">#添加此行</span><br>.....<br>; Default Value: not <span class="hljs-built_in">set</span><br>pm.status_path = /fpm_status       <span class="hljs-comment">#取消此行注释,且便于区分，将status改为fpm_status</span><br>.....<br>; Default Value: not <span class="hljs-built_in">set</span><br>ping.path = /ping                 <span class="hljs-comment">#取消此行注释</span><br>....<br>; Default Value: pong<br>ping.response = pong              <span class="hljs-comment">#取消此行注释</span><br>:wq<br>[root@proxy ~]<span class="hljs-comment">#systemctl restart php-fpm</span><br><br></code></pre></td></tr></table></figure>

<h4 id="5-4、在DNS里添加解析（以前搭建的DNS）"><a href="#5-4、在DNS里添加解析（以前搭建的DNS）" class="headerlink" title="5.4、在DNS里添加解析（以前搭建的DNS）"></a>5.4、在DNS里添加解析（以前搭建的DNS）</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#DNS主机：10.0.0.128</span><br>[root@DNS ~]<span class="hljs-comment">#vim /var/named/magedu.org.zone</span><br><span class="hljs-variable">$TTL</span> 1D<br>@         IN    SOA   master  admin.magedu.org ( 6  1D  10M  1D  6H  )<br>                NS    master<br>                NS    slave1<br>master          A     10.0.0.128<br>slave1          A     10.0.0.184<br>kodbox          A     10.0.0.184<br>:wq<br>[root@DNS ~]<span class="hljs-comment">#rndc reload                     #重新加载</span><br>server reload successful<br><br><span class="hljs-comment">#将10.0.0.184的DNS指向10.0.0.128</span><br>[root@proxy ~]<span class="hljs-comment">#vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br>DNS1=10.0.0.128<br>:wq<br>[root@proxy ~]<span class="hljs-comment">#nmcli connection reload</span><br>[root@proxy ~]<span class="hljs-comment">#nmcli connection up eth0</span><br></code></pre></td></tr></table></figure>

<h4 id="5-5、可道云下载"><a href="#5-5、可道云下载" class="headerlink" title="5.5、可道云下载"></a>5.5、可道云下载</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@proxy ~]<span class="hljs-comment">#wget https://static.kodcloud.com/update/download/kodbox.1.35.zip</span><br>[root@proxy ~]<span class="hljs-comment">#unzip kodbox.1.35.zip -d /data/nginx/kodbox</span><br>[root@proxy ~]<span class="hljs-comment">#ll /data/nginx/kodbox</span><br>total 172<br>drwxr-xr-x  8 root root    110 Oct 31 18:31 app<br>-rw-r--r--  1 root root 168291 Oct 31 18:31 Changelog.md<br>drwxr-xr-x  3 root root     91 Oct 31 18:31 config<br>drwxr-xr-x  3 root root     20 Oct 31 18:31 data<br>-rw-r--r--  1 root root    157 Oct 31 18:31 index.php<br>drwxr-xr-x 18 root root    260 Oct 31 18:31 plugins<br>drwxr-xr-x  6 root root     58 Oct 31 18:31 static<br>[root@proxy ~]<span class="hljs-comment">#chown -R nginx.nginx /data/nginx/kodbox</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221130173134603.png" srcset="/img/loading.gif" lazyload alt="image-20221130173134603"></a></p>
<p>下一步：</p>
<p><a href=""><img src="image-20221130173336671.png" srcset="/img/loading.gif" lazyload alt="image-20221130173336671"></a></p>
<p><strong>此时发现仍缺少redis的相关组件</strong></p>
<h4 id="5-6、编译安装redis相关组件"><a href="#5-6、编译安装redis相关组件" class="headerlink" title="5.6、编译安装redis相关组件"></a>5.6、编译安装redis相关组件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@proxy ~]<span class="hljs-comment">#wget https://pecl.php.net/get/redis-5.3.7.tgz</span><br>[root@proxy ~]<span class="hljs-comment">#mv redis-5.3.7.tgz /usr/local/src</span><br>[root@proxy ~]<span class="hljs-comment">#cd /usr/local/src</span><br>[root@proxy src]<span class="hljs-comment">#tar xf redis-5.3.7.tgz </span><br>[root@proxy src]<span class="hljs-comment">#ls</span><br>echo-nginx-module-0.63  nginx-1.20.2.tar.gz     package.xml  redis-5.3.7.tgz  v0.63.tar.gz  nginx-1.20.2  nginx-module-vts-0.2.1  redis-5.3.7  v0.2.1.tar.gz<br>[root@proxy src]<span class="hljs-comment">#cd redis-5.3.7/</span><br><span class="hljs-comment">#进入目录后发现没有./configure</span><br>[root@proxy redis-5.3.7]<span class="hljs-comment">#less README.markdown   #查看如何编译安装</span><br><span class="hljs-comment">## Installation</span><br>For everything you should need to install PhpRedis on your system,<br>see the [INSTALL.markdown](./INSTALL.markdown) page.  <span class="hljs-comment">#提示让看INSTALL.markdown</span><br>[root@proxy redis-5.3.7]<span class="hljs-comment">#less INSTALL.markdown</span><br><span class="hljs-built_in">cd</span> phpredis<br>phpize            <span class="hljs-comment">#执行此命令后会生成phpize</span><br>./configure [--enable-redis-igbinary] [--enable-redis-msgpack] [--enable-redis-lzf [--with-liblzf[=DIR]]] [--enable-redis-zstd]<br>make &amp;&amp; make install<br>[root@proxy redis-5.3.7]<span class="hljs-comment">#phpize</span><br>-bash: phpize: <span class="hljs-built_in">command</span> not found<br>[root@proxy redis-5.3.7]<span class="hljs-comment">#yum provides phpize    #查找phpize在哪个包里，在php-cli这个包里</span><br>Last metadata expiration check: 1:56:31 ago on Wed 30 Nov 2022 04:13:44 PM CST.<br>php-cli-7.2.24-1.module+el8.4.0+413+c9202dda.x86_64 : Command-line interface <span class="hljs-keyword">for</span> PHP<br>Repo        : AppStream<br>Matched from:<br>Filename    : /usr/bin/phpize<br>[root@proxy redis-5.3.7]<span class="hljs-comment">#yum -y install php-cli</span><br>[root@proxy redis-5.3.7]<span class="hljs-comment">#phpize         #显示少php-devel包</span><br>Can<span class="hljs-string">&#x27;t find PHP headers in /usr/include/php</span><br><span class="hljs-string">The php-devel package is required for use of this command.</span><br><span class="hljs-string">[root@proxy redis-5.3.7]#yum -y install php-devel</span><br><span class="hljs-string">[root@proxy redis-5.3.7]#./configure</span><br><span class="hljs-string">[root@proxy redis-5.3.7]#make &amp;&amp; make install</span><br><span class="hljs-string">Installing shared extensions:     /usr/lib64/php/modules/   #提示模块安装的路径</span><br><span class="hljs-string">[root@proxy redis-5.3.7]#ls /usr/lib64/php/modules/</span><br><span class="hljs-string">bz2.so    dom.so   gd.so    mbstring.so   pdo.so      simplexml.so   wddx.so    calendar.so    exif.so      gettext.so    mysqli.so   pdo_sqlite.so  sockets.so    xmlreader.so   ctype.so     fileinfo.so   iconv.so    mysqlnd.so     phar.so        sqlite3.so     xml.so       curl.so       ftp.so      json.so        pdo_mysql.so  redis.so      tokenizer.so  xmlwriter.so  xsl.so</span><br><span class="hljs-string">#但此时PHP程序不知道有redis模块，需人为进行添加</span><br><span class="hljs-string">[root@proxy redis-5.3.7]#vim /etc/php.d/</span><br><span class="hljs-string">20-bz2.ini         20-fileinfo.ini    20-mbstring.ini    20-sqlite3.ini     </span><br><span class="hljs-string">20-calendar.ini    20-ftp.ini         20-mysqlnd.ini     20-tokenizer.ini   </span><br><span class="hljs-string">20-ctype.ini       20-gd.ini          20-pdo.ini         20-xml.ini         </span><br><span class="hljs-string">20-curl.ini        20-gettext.ini     20-phar.ini        20-xmlwriter.ini   </span><br><span class="hljs-string">20-dom.ini         20-iconv.ini       20-simplexml.ini   20-xsl.ini         </span><br><span class="hljs-string">20-exif.ini        20-json.ini        20-sockets.ini     30-mysqli.ini    </span><br><span class="hljs-string">30-pdo_mysql.ini   30-pdo_sqlite.ini  30-wddx.ini        30-xmlreader.ini</span><br><span class="hljs-string">[root@proxy redis-5.3.7]#vim /etc/php.d/31-redis.ini</span><br><span class="hljs-string">extension=redis                          #添加此行</span><br><span class="hljs-string">:wq</span><br><span class="hljs-string">[root@proxy redis-5.3.7]#systemctl restart php-fpm</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221130183021629.png" srcset="/img/loading.gif" lazyload alt="image-20221130183021629"></a></p>
<p><a href=""><img src="image-20221130183130306.png" srcset="/img/loading.gif" lazyload alt="image-20221130183130306"></a></p>
<p><a href=""><img src="image-20221130183154802.png" srcset="/img/loading.gif" lazyload alt="image-20221130183154802"></a></p>
<h3 id="六、jumpserver-总结安装部署，添加用户授权，行为审计。"><a href="#六、jumpserver-总结安装部署，添加用户授权，行为审计。" class="headerlink" title="六、jumpserver 总结安装部署，添加用户授权，行为审计。"></a>六、jumpserver 总结安装部署，添加用户授权，行为审计。</h3><p>官方文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ABAP">https://docs.jumpserver.org/zh/master/install/setup_by_fast/<br></code></pre></td></tr></table></figure>

<h4 id="6-1、安装要求"><a href="#6-1、安装要求" class="headerlink" title="6.1、安装要求"></a>6.1、安装要求</h4><p><strong>JumpServer 环境要求:</strong></p>
<p>①硬件配置: 2个CPU核心, 4G 内存, 50G 硬盘（最低）</p>
<p>②操作系统: Linux 发行版 x86_64</p>
<p>③Python = 3.6.x</p>
<p>④MySQL Server ≥ 5.6 或者 Mariadb Server ≥ 5.5.56 数据库编码要求 uft8,新版要求5.7以上</p>
<p>⑤Redis: 新版要求6.0以上</p>
<h4 id="6-2、安装方法"><a href="#6-2、安装方法" class="headerlink" title="6.2、安装方法"></a>6.2、安装方法</h4><p><strong>官方提供了多种安装方法</strong></p>
<p>①手动部署: 一步一步实现</p>
<p>②极速部署: 资产数量不多，或者测试体验的用户请使用本脚本快速部署</p>
<p>③容器部署: 基于docker 实现</p>
<p>④分布式部署: 适用大型环境</p>
<h4 id="6-3、基于容器部署"><a href="#6-3、基于容器部署" class="headerlink" title="6.3、基于容器部署"></a>6.3、基于容器部署</h4><p>官方文档：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/jumpserver/Dockerfile/tree/master/allinone<br>https://docs.jumpserver.org/zh/master/install/docker_install/<br></code></pre></td></tr></table></figure>

<h5 id="6-3-1、环境说明"><a href="#6-3-1、环境说明" class="headerlink" title="6.3.1、环境说明"></a>6.3.1、环境说明</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/jumpserver/Dockerfile/tree/master/allinone<br></code></pre></td></tr></table></figure>

<p>使用外置 MySQL 数据库和 Redis:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">- 外置数据库要求 MySQL 版本大于等于 5.7<br>- 外置 Redis 要求 Redis 版本大于等于 6.0<br># 自行部署 MySQL 可以参考<br>(https://docs.jumpserver.org/zh/master/install/setup_by_lb/#mysql)<br># mysql 创建用户并赋予权限, 请自行替换 nu4x599Wq7u0Bn8EABh3J91G 为自己的密码<br>mysql -u root -p<br>create database jumpserver default charset &#x27;utf8&#x27;;<br>create user &#x27;jumpserver&#x27;@&#x27;%&#x27; identified by &#x27;nu4x599Wq7u0Bn8EABh3J91G&#x27;;<br>grant all on jumpserver.* to &#x27;jumpserver&#x27;@&#x27;%&#x27;;<br>flush privileges;<br># 自行部署 Redis 可以参考<br>(https://docs.jumpserver.org/zh/master/install/setup_by_lb/#redis)<br></code></pre></td></tr></table></figure>

<p><strong>基于容器,安装完毕后可以通过以下方式访问</strong></p>
<p>①浏览器访问: http://&lt;容器所在服务器IP&gt; </p>
<p>②默认管理员账户 admin 密码 admin</p>
<p>③SSH 访问: ssh -p 2222 &lt;容器所在服务器IP&gt; </p>
<p>④XShell 等工具请添加 connection 连接, 默认 ssh 端口 2222</p>
<p><strong>容器docker安装</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker ~]<span class="hljs-comment">#cat install_docker.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><br>DOCKER_VERSION=<span class="hljs-string">&quot;20.10.10&quot;</span><br>UBUNTU_DOCKER_VERSION=<span class="hljs-string">&quot;5:<span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span>~3-0~`lsb_release -si`-`lsb_release -cs`&quot;</span><br><span class="hljs-comment">#UBUNTU_DOCKER_VERSION=&quot;5:20.10.9~3-0~`lsb_release -si`-`lsb_release -cs`&quot;</span><br><span class="hljs-comment">#UBUNTU_DOCKER_VERSION=&quot;5:19.03.14~3-0~lsb_release -si-`lsb_release -cs`&quot;</span><br><br>COLOR_SUCCESS=<span class="hljs-string">&quot;echo -e \\033[1;32m&quot;</span><br>COLOR_FAILURE=<span class="hljs-string">&quot;echo -e \\033[1;31m&quot;</span><br>END=<span class="hljs-string">&quot;\033[m&quot;</span><br><br>. /etc/os-release<br><br><span class="hljs-function"><span class="hljs-title">color</span></span> () &#123;<br>    RES_COL=60<br>    MOVE_TO_COL=<span class="hljs-string">&quot;echo -en \\033[<span class="hljs-variable">$&#123;RES_COL&#125;</span>G&quot;</span><br>    SETCOLOR_SUCCESS=<span class="hljs-string">&quot;echo -en \\033[1;32m&quot;</span><br>    SETCOLOR_FAILURE=<span class="hljs-string">&quot;echo -en \\033[1;31m&quot;</span><br>    SETCOLOR_WARNING=<span class="hljs-string">&quot;echo -en \\033[1;33m&quot;</span><br>    SETCOLOR_NORMAL=<span class="hljs-string">&quot;echo -en \E[0m&quot;</span><br>    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> &amp;&amp; <span class="hljs-variable">$MOVE_TO_COL</span><br>    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">&quot;[&quot;</span><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$2</span> = <span class="hljs-string">&quot;success&quot;</span> -o <span class="hljs-variable">$2</span> = <span class="hljs-string">&quot;0&quot;</span> ] ;<span class="hljs-keyword">then</span><br>        <span class="hljs-variable">$&#123;SETCOLOR_SUCCESS&#125;</span><br>        <span class="hljs-built_in">echo</span> -n $<span class="hljs-string">&quot;  OK  &quot;</span>    <br>    <span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$2</span> = <span class="hljs-string">&quot;failure&quot;</span> -o <span class="hljs-variable">$2</span> = <span class="hljs-string">&quot;1&quot;</span>  ] ;<span class="hljs-keyword">then</span> <br>        <span class="hljs-variable">$&#123;SETCOLOR_FAILURE&#125;</span><br>        <span class="hljs-built_in">echo</span> -n $<span class="hljs-string">&quot;FAILED&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-variable">$&#123;SETCOLOR_WARNING&#125;</span><br>        <span class="hljs-built_in">echo</span> -n $<span class="hljs-string">&quot;WARNING&quot;</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-variable">$&#123;SETCOLOR_NORMAL&#125;</span><br>    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">&quot;]&quot;</span><br>    <span class="hljs-built_in">echo</span> <br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-title">install_docker</span></span>()&#123;<br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$ID</span> = <span class="hljs-string">&quot;centos&quot;</span> -o <span class="hljs-variable">$ID</span> = <span class="hljs-string">&quot;rocky&quot;</span> ];<span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$VERSION_ID</span> = <span class="hljs-string">&quot;7&quot;</span> ];<span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">cat</span> &gt;  /etc/yum.repos.d/docker.repo  &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[docker]</span><br><span class="hljs-string">name=docker</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">#baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/</span><br><span class="hljs-string">baseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/7/x86_64/stable/</span><br><span class="hljs-string">EOF</span><br>        <span class="hljs-keyword">else</span>     <br>            <span class="hljs-built_in">cat</span> &gt;  /etc/yum.repos.d/docker.repo  &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[docker]</span><br><span class="hljs-string">name=docker</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">#baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/8/x86_64/stable/</span><br><span class="hljs-string">baseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/8/x86_64/stable/</span><br><span class="hljs-string">EOF</span><br>        <span class="hljs-keyword">fi</span><br>	    yum clean all <br>        <span class="hljs-variable">$&#123;COLOR_FAILURE&#125;</span> <span class="hljs-string">&quot;Docker有以下版本&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>        yum list docker-ce --showduplicates<br>        <span class="hljs-variable">$&#123;COLOR_FAILURE&#125;</span><span class="hljs-string">&quot;5秒后即将安装: docker-&quot;</span><span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span><span class="hljs-string">&quot; 版本.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>        <span class="hljs-variable">$&#123;COLOR_FAILURE&#125;</span><span class="hljs-string">&quot;如果想安装其它Docker版本，请按ctrl+c键退出，修改版本再执行&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>        <span class="hljs-built_in">sleep</span> 5<br>        yum -y install docker-ce-<span class="hljs-variable">$DOCKER_VERSION</span> docker-ce-cli-<span class="hljs-variable">$DOCKER_VERSION</span>  \<br>            || &#123; color <span class="hljs-string">&quot;Base,Extras的yum源失败,请检查yum源配置&quot;</span> 1;<span class="hljs-built_in">exit</span>; &#125;<br>    <span class="hljs-keyword">else</span><br>	    dpkg -s docker-ce &amp;&gt; /dev/null &amp;&amp; <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;Docker已安装，退出&quot;</span> 1 &amp;&amp; <span class="hljs-built_in">exit</span><br>        apt update || &#123; color <span class="hljs-string">&quot;更新包索引失败&quot;</span> 1 ; <span class="hljs-built_in">exit</span> 1; &#125;  <br>        apt  -y install apt-transport-https ca-certificates curl software-properties-common || \<br>            &#123; color <span class="hljs-string">&quot;安装相关包失败&quot;</span> 1 ; <span class="hljs-built_in">exit</span> 2;  &#125;  <br>        curl -fsSL https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -<br>        add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br>        apt update<br>        <span class="hljs-variable">$&#123;COLOR_FAILURE&#125;</span> <span class="hljs-string">&quot;Docker有以下版本&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>        apt-cache madison docker-ce<br>        <span class="hljs-variable">$&#123;COLOR_FAILURE&#125;</span><span class="hljs-string">&quot;5秒后即将安装: docker-&quot;</span><span class="hljs-variable">$&#123;UBUNTU_DOCKER_VERSION&#125;</span><span class="hljs-string">&quot; 版本.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>        <span class="hljs-variable">$&#123;COLOR_FAILURE&#125;</span><span class="hljs-string">&quot;如果想安装其它Docker版本，请按ctrl+c键退出，修改版本再执行&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>        <span class="hljs-built_in">sleep</span> 5<br>        apt -y  install docker-ce=<span class="hljs-variable">$&#123;UBUNTU_DOCKER_VERSION&#125;</span> docker-ce-cli=<span class="hljs-variable">$&#123;UBUNTU_DOCKER_VERSION&#125;</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>        color <span class="hljs-string">&quot;安装软件包成功&quot;</span>  0<br>    <span class="hljs-keyword">else</span><br>        color <span class="hljs-string">&quot;安装软件包失败，请检查网络配置&quot;</span> 1<br>        <span class="hljs-built_in">exit</span><br>    <span class="hljs-keyword">fi</span><br>        <br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">config_docker</span></span> ()&#123;<br>    <span class="hljs-built_in">mkdir</span> -p /etc/docker<br>    <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br>	  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>],<br>	  <span class="hljs-string">&quot;insecure-registries&quot;</span>:[<span class="hljs-string">&quot;harbor.magedu.org:80&quot;</span>]<br>&#125;<br>EOF<br>    systemctl daemon-reload<br>    systemctl <span class="hljs-built_in">enable</span> docker<br>    systemctl restart docker<br>    docker version &amp;&amp; color <span class="hljs-string">&quot;Docker 安装成功&quot;</span> 0 ||  color <span class="hljs-string">&quot;Docker 安装失败&quot;</span> 1<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-title">set_alias</span></span> ()&#123;<br>	<span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;alias rmi=&quot;docker images -qa|xargs docker rmi -f&quot;&#x27;</span> &gt;&gt; ~/.bashrc<br>	<span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;alias rmc=&quot;docker ps -qa|xargs docker rm -f&quot;&#x27;</span> &gt;&gt; ~/.bashrc<br>&#125;<br><br><br>install_docker<br>config_docker <br>set_alias<br><br></code></pre></td></tr></table></figure>



<h5 id="6-3-2、安装MySQL服务"><a href="#6-3-2、安装MySQL服务" class="headerlink" title="6.3.2、安装MySQL服务"></a>6.3.2、安装MySQL服务</h5><p>官方说明：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://docs.jumpserver.org/zh/master/install/prod/distributed_03/<br></code></pre></td></tr></table></figure>

<p>MYSQL要求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create database jumpserver default charset &#x27;utf8&#x27;;<br>create user &#x27;jumpserver&#x27;@&#x27;%&#x27; identified by &#x27;nu4x599Wq7u0Bn8EABh3J91G&#x27;;<br>grant all on jumpserver.* to &#x27;jumpserver&#x27;@&#x27;%&#x27;;<br>flush privileges;<br></code></pre></td></tr></table></figure>

<h6 id="6-3-2-1、在宿主机准备MySQL配置文件"><a href="#6-3-2-1、在宿主机准备MySQL配置文件" class="headerlink" title="6.3.2.1、在宿主机准备MySQL配置文件"></a>6.3.2.1、在宿主机准备MySQL配置文件</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#准备相关目录</span><br>[root@docker ~]<span class="hljs-comment">#mkdir -p /etc/mysql/mysql.conf.d/</span><br>[root@docker ~]<span class="hljs-comment">#mkdir -p /etc/mysql/conf.d/</span><br><br><span class="hljs-comment">#生成服务器配置文件,指定字符集</span><br>[root@docker ~]<span class="hljs-comment">#tee /etc/mysql/mysql.conf.d/mysqld.cnf &lt;&lt;EOF</span><br>[mysqld]<br>pid-file= /var/run/mysqld/mysqld.pid<br>socket= /var/run/mysqld/mysqld.sock<br>datadir= /var/lib/mysql<br>symbolic-links=0<br>character-set-server=utf8   <span class="hljs-comment">#添加此行,指定字符集</span><br>EOF<br><br><span class="hljs-comment">#生成客户端配置文件,指定字符集</span><br>[root@docker ~]<span class="hljs-comment">#tee /etc/mysql/conf.d/mysql.cnf &lt;&lt;EOF</span><br>[mysql]<br>default-character-set=utf8<br>EOF<br><br><span class="hljs-comment">#查看配置文件列表</span><br>[root@docker ~]<span class="hljs-comment">#tree /etc/mysql/</span><br>/etc/mysql/<br>├── conf.d<br>│   └── mysql.cnf<br>└── mysql.conf.d<br>    └── mysqld.cnf<br><br>2 directories, 2 files<br></code></pre></td></tr></table></figure>

<h6 id="6-3-2-2、启动MySQL容器"><a href="#6-3-2-2、启动MySQL容器" class="headerlink" title="6.3.2.2、启动MySQL容器"></a>6.3.2.2、启动MySQL容器</h6><p>将上面宿主机的设置好的配置文件挂载至MySQL容器</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker ~]<span class="hljs-comment">#docker run -d -p 3306:3306 --name mysql --restart always \</span><br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-e MYSQL_DATABASE=jumpserver \<br>-e MYSQL_USER=jumpserver \<br>-e MYSQL_PASSWORD=123456 \<br>-v /data/mysql:/var/lib/mysql \<br>-v /etc/mysql/mysql.conf.d/mysqld.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf \<br>-v /etc/mysql/conf.d/mysql.cnf:/etc/mysql/conf.d/mysql.cnf  mysql:5.7.30<br></code></pre></td></tr></table></figure>

<h6 id="6-3-2-3、查看验证mysql"><a href="#6-3-2-3、查看验证mysql" class="headerlink" title="6.3.2.3、查看验证mysql"></a>6.3.2.3、查看验证mysql</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY   TAG       IMAGE ID       CREATED       SIZE<br>mysql        5.7.30    9cfcce23593a   2 years ago   448MB<br>[root@docker ~]<span class="hljs-comment">#ss -ntl</span><br>State    Recv-Q    Send-Q    Local Address:Port     Peer Address:Port      Process   <br>LISTEN    0         128       0.0.0.0:22              0.0.0.0:*                     <br>LISTEN    0         128       0.0.0.0:3306            0.0.0.0:*                     <br>LISTEN    0         128       *:80                    *:*                      <br>LISTEN    0         128       [::]:22                 [::]:*                      <br>LISTEN    0         128       [::]:3306               [::]:*    <br><br><span class="hljs-comment">#在其他机器上连接docker安装的mysql</span><br>[root@client ~]<span class="hljs-comment">#mysql -uroot -p123456 -h10.0.0.186</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection <span class="hljs-built_in">id</span> is 2<br>Server version: 5.7.30 MySQL Community Server (GPL)<br>[root@client ~]<span class="hljs-comment">#mysql -ujumpserver -p123456 -h10.0.0.186</span><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| jumpserver         |<br>+--------------------+<br><br></code></pre></td></tr></table></figure>

<h5 id="6-3-3、安装Redis服务"><a href="#6-3-3、安装Redis服务" class="headerlink" title="6.3.3、安装Redis服务"></a>6.3.3、安装Redis服务</h5><p>官方说明：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://docs.jumpserver.org/zh/master/install/prod/distributed_04/<br></code></pre></td></tr></table></figure>

<p>新版要求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ABAP">外置 Redis 要求 Redis 版本大于等于 6.0<br></code></pre></td></tr></table></figure>

<h6 id="6-3-3-1、启动redis"><a href="#6-3-3-1、启动redis" class="headerlink" title="6.3.3.1、启动redis"></a>6.3.3.1、启动redis</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker ~]<span class="hljs-comment">#docker run -d -p 6379:6379 --name redis --restart always redis</span><br></code></pre></td></tr></table></figure>

<h6 id="6-3-3-2、验证Redis连接"><a href="#6-3-3-2、验证Redis连接" class="headerlink" title="6.3.3.2、验证Redis连接"></a>6.3.3.2、验证Redis连接</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@client ~]<span class="hljs-comment">#yum -y install redis</span><br>[root@client ~]<span class="hljs-comment">#redis-cli -h 10.0.0.186</span><br>10.0.0.186:6379&gt; info<br><span class="hljs-comment"># Server</span><br>redis_version:6.2.6<br><br></code></pre></td></tr></table></figure>

<h5 id="6-3-4、部署JumpServer"><a href="#6-3-4、部署JumpServer" class="headerlink" title="6.3.4、部署JumpServer"></a>6.3.4、部署JumpServer</h5><h6 id="6-3-4-1、生成key和token"><a href="#6-3-4-1、生成key和token" class="headerlink" title="6.3.4.1、生成key和token"></a>6.3.4.1、生成key和token</h6><p>官方说明</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/jumpserver/Dockerfile/tree/master/allinone<br>https://docs.jumpserver.org/zh/master/install/docker_install/<br></code></pre></td></tr></table></figure>

<p><strong>需要先生成key和token</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker ~]<span class="hljs-comment">#vim key.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">if</span> [ ! <span class="hljs-string">&quot;<span class="hljs-variable">$SECRET_KEY</span>&quot;</span> ];<br>   <span class="hljs-keyword">then</span> SECRET_KEY=`<span class="hljs-built_in">cat</span> /dev/urandom | <span class="hljs-built_in">tr</span> -dc A-Za-z0-9 | <span class="hljs-built_in">head</span> -c 50`;<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;SECRET_KEY=<span class="hljs-variable">$SECRET_KEY</span>&quot;</span> &gt;&gt; ~/.bashrc; <span class="hljs-built_in">echo</span> SECRET_KEY=<span class="hljs-variable">$SECRET_KEY</span>;<br><span class="hljs-keyword">else</span> <span class="hljs-built_in">echo</span> SECRET_KEY=<span class="hljs-variable">$SECRET_KEY</span>;<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ ! <span class="hljs-string">&quot;<span class="hljs-variable">$BOOTSTRAP_TOKEN</span>&quot;</span> ];<br>   <span class="hljs-keyword">then</span> BOOTSTRAP_TOKEN=`<span class="hljs-built_in">cat</span> /dev/urandom | <span class="hljs-built_in">tr</span> -dc A-Za-z0-9 | <span class="hljs-built_in">head</span> -c 16`;<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;BOOTSTRAP_TOKEN=<span class="hljs-variable">$BOOTSTRAP_TOKEN</span>&quot;</span> &gt;&gt; ~/.bashrc;<br>   <span class="hljs-built_in">echo</span> BOOTSTRAP_TOKEN=<span class="hljs-variable">$BOOTSTRAP_TOKEN</span>;<br><span class="hljs-keyword">else</span> <span class="hljs-built_in">echo</span> BOOTSTRAP_TOKEN=<span class="hljs-variable">$BOOTSTRAP_TOKEN</span>;<br><span class="hljs-keyword">fi</span><br>:wq<br>[root@docker ~]<span class="hljs-comment">#bash key.sh </span><br>SECRET_KEY=GkYTTfwge2HpQDiqjQ7hGqR7vEsSACM4rjgAlRbPE4gM7UKw7J<br>BOOTSTRAP_TOKEN=gdqRJc1By36Rq9pc<br>[root@docker ~]<span class="hljs-comment">#tail -n2 .bashrc</span><br>SECRET_KEY=GkYTTfwge2HpQDiqjQ7hGqR7vEsSACM4rjgAlRbPE4gM7UKw7J<br>BOOTSTRAP_TOKEN=gdqRJc1By36Rq9pc<br></code></pre></td></tr></table></figure>

<h6 id="6-3-4-2、运行容器"><a href="#6-3-4-2、运行容器" class="headerlink" title="6.3.4.2、运行容器"></a>6.3.4.2、运行容器</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sh">-----------------------------------------------------------------------------------<br><span class="hljs-comment">#在执行前须确保80端口未被启用，如果之前已经启用会报以下错误</span><br>docker: Error response from daemon: driver failed programming external connectivity on endpoint jms_all (6e30f944775bad02dad4865998908f432c97b740bc2f3f211cbb4f6d1adabf63): Error starting userland proxy: listen tcp4 0.0.0.0:80: <span class="hljs-built_in">bind</span>: address already <span class="hljs-keyword">in</span> use.<br>-----------------------------------------------------------------------------------<br><br>[root@docker ~]<span class="hljs-comment">#docker run --name jms_all -d \</span><br>-v /opt/jumpserver/core/data:/opt/jumpserver/data \<br>-v /opt/jumpserver/koko/data:/opt/koko/data \<br>-v /opt/jumpserver/lion/data:/opt/lion/data \<br>-p 80:80 \<br>-p 2222:2222 \<br>-e SECRET_KEY=GkYTTfwge2HpQDiqjQ7hGqR7vEsSACM4rjgAlRbPE4gM7UKw7J \<br>-e BOOTSTRAP_TOKEN=gdqRJc1By36Rq9pc \<br>-e LOG_LEVEL=ERROR \<br>-e DB_HOST=10.0.0.186 \<br>-e DB_PORT=3306 \<br>-e DB_USER=jumpserver \<br>-e DB_PASSWORD=123456 \<br>-e DB_NAME=jumpserver \<br>-e REDIS_HOST=10.0.0.186 \<br>-e REDIS_PORT=6379 \<br>-e REDIS_PASSWORD=<span class="hljs-string">&#x27;&#x27;</span> \<br>--privileged=<span class="hljs-literal">true</span> \<br>jumpserver/jms_all<br><br>-----------------------------------------------------------------------------------<br><span class="hljs-comment">#如果报以下错误：说明jms_all被占用，需要删除或者重命名</span><br>docker: Error response from daemon: Conflict. The container name <span class="hljs-string">&quot;/jms_all&quot;</span> is already <span class="hljs-keyword">in</span> use by container <span class="hljs-string">&quot;10aecc51ec5bfd5a8121480a49bfdba40c6218868f1ac2f4e76ce685e3ef4412&quot;</span>. You have to remove (or rename) that container to be able to reuse that name.<br><span class="hljs-comment">#删除方法：</span><br>[root@docker ~]<span class="hljs-comment">#docker ps -a            #先查看现在运行的程序</span><br>CONTAINER ID   IMAGE                COMMAND                  CREATED             STATUS             PORTS                                                  NAMES<br>10aecc51ec5b   jumpserver/jms_all   <span class="hljs-string">&quot;./entrypoint.sh&quot;</span>        17 minutes ago      Created                                                                   jms_all<br>ea0fcb85ce50   redis                <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   About an hour ago   Up About an hour   0.0.0.0:6379-&gt;6379/tcp, :::6379-&gt;6379/tcp              redis<br>26371d0aad4b   mysql:5.7.30         <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   About an hour ago   Up About an hour   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mysql<br>[root@docker ~]<span class="hljs-comment">#docker rm jms_all        #删除jms_all</span><br>jms_all<br>-----------------------------------------------------------------------------------<br></code></pre></td></tr></table></figure>

<h6 id="6-3-4-3、验证是否成功"><a href="#6-3-4-3、验证是否成功" class="headerlink" title="6.3.4.3、验证是否成功"></a>6.3.4.3、验证是否成功</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker ~]<span class="hljs-comment">#docker logs -f jms_all</span><br>......<br>2022-12-01 12:51:29 JumpServer version v2.17.2, more see https://www.jumpserver.org<br>Migrate model org <span class="hljs-built_in">id</span>: UserGroupStarting supervisor: supervisord.<br>Jumpserver ALL v2.17.2<br>官网 http://www.jumpserver.org<br>文档 http://docs.jumpserver.org<br><br>进入容器命令 docker <span class="hljs-built_in">exec</span> -it jms_all /bin/bash<br><br><span class="hljs-comment">#下面就可以在浏览器里直接输入ip地址访问了</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221201130318586.png" srcset="/img/loading.gif" lazyload alt="image-20221201130318586"></a></p>
<p><strong>注意：首次登录的初始账号和密码均为admin</strong></p>
<p>登录进去后，会立刻让更改密码</p>
<p><a href=""><img src="image-20221201130505437.png" srcset="/img/loading.gif" lazyload alt="image-20221201130505437"></a></p>
<p>更改密码后重新登录</p>
<p><a href=""><img src="image-20221201170207670.png" srcset="/img/loading.gif" lazyload alt="image-20221201170207670"></a></p>
<h4 id="6-4、用户授权和行为审计"><a href="#6-4、用户授权和行为审计" class="headerlink" title="6.4、用户授权和行为审计"></a>6.4、用户授权和行为审计</h4><h5 id="6-4-1、创建组"><a href="#6-4-1、创建组" class="headerlink" title="6.4.1、创建组"></a>6.4.1、创建组</h5><p>创建开发组和测试组</p>
<p><a href=""><img src="image-20221201173556242.png" srcset="/img/loading.gif" lazyload alt="image-20221201173556242"></a></p>
<p><a href=""><img src="image-20221201173734350.png" srcset="/img/loading.gif" lazyload alt="image-20221201173734350"></a></p>
<h5 id="6-4-2、创建用户并加入组"><a href="#6-4-2、创建用户并加入组" class="headerlink" title="6.4.2、创建用户并加入组"></a>6.4.2、创建用户并加入组</h5><p>创建用户：xiaoming并加入开发组</p>
<p><a href=""><img src="image-20221202090518852.png" srcset="/img/loading.gif" lazyload alt="image-20221202090518852"></a></p>
<p><a href=""><img src="image-20221201180305733.png" srcset="/img/loading.gif" lazyload alt="image-20221201180305733"></a></p>
<p>创建用户：xiaohong并加入测试组</p>
<p><a href=""><img src="image-20221201180521002.png" srcset="/img/loading.gif" lazyload alt="image-20221201180521002"></a></p>
<p>登录账户：xiaoming，首次登录需要完善个人信息</p>
<p><a href=""><img src="image-20221201181249048.png" srcset="/img/loading.gif" lazyload alt="image-20221201181249048"></a></p>
<h5 id="6-4-3、创建系统审计员"><a href="#6-4-3、创建系统审计员" class="headerlink" title="6.4.3、创建系统审计员"></a>6.4.3、创建系统审计员</h5><p>创建系统审计员：mage</p>
<p><a href=""><img src="image-20221201181034200.png" srcset="/img/loading.gif" lazyload alt="image-20221201181034200"></a></p>
<p>登录账户：mage，左侧管理向与普通用户不同</p>
<p><a href=""><img src="image-20221201181526636.png" srcset="/img/loading.gif" lazyload alt="image-20221201181526636"></a></p>
<h5 id="6-4-4、创建管理用户"><a href="#6-4-4、创建管理用户" class="headerlink" title="6.4.4、创建管理用户"></a>6.4.4、创建管理用户</h5><p>管理用户是jumpServer用来管理后端服务器或其它资产的管理员用户,此用户必须对后端服务器有管理权限</p>
<p><strong>管理用户特点:</strong></p>
<p>①通常是后端服务器的root或者是具备root权限的超级用户</p>
<p>②用于推送或者是创建系统用户</p>
<p>③用于获取被管理的硬件资产信息</p>
<p><a href=""><img src="image-20221201181844951.png" srcset="/img/loading.gif" lazyload alt="image-20221201181844951"></a></p>
<p><a href=""><img src="image-20221201182211875.png" srcset="/img/loading.gif" lazyload alt="image-20221201182211875"></a></p>
<h5 id="6-4-5、创建资产并实现资产分类"><a href="#6-4-5、创建资产并实现资产分类" class="headerlink" title="6.4.5、创建资产并实现资产分类"></a>6.4.5、创建资产并实现资产分类</h5><p>创建可以被jumpServer用户访问的后端服务器和其它资产,比如:路由器,交换机等</p>
<p><a href=""><img src="image-20221201182544795.png" srcset="/img/loading.gif" lazyload alt="image-20221201182544795"></a></p>
<p><a href=""><img src="image-20221201182843812.png" srcset="/img/loading.gif" lazyload alt="image-20221201182843812"></a></p>
<p><a href=""><img src="image-20221201183120445.png" srcset="/img/loading.gif" lazyload alt="image-20221201183120445"></a></p>
<p>开发环境和测试环境各加入一台服务器</p>
<p><a href=""><img src="image-20221201183341015.png" srcset="/img/loading.gif" lazyload alt="image-20221201183341015"></a></p>
<h5 id="6-4-6、创建系统用户"><a href="#6-4-6、创建系统用户" class="headerlink" title="6.4.6、创建系统用户"></a>6.4.6、创建系统用户</h5><p>系统用户是分配给JumpServer用户,用来让JumpServer用户在连接后端服务器和其它资产,一般不会给管理权限</p>
<p>生产环境中,一般都会利用自动化运维工具提前在后端服务器创建好系统用户,在所有后端服务器统一用户ID信息,而非在jumpserver中创建</p>
<p><a href=""><img src="image-20221201183910518.png" srcset="/img/loading.gif" lazyload alt="image-20221201183910518"></a></p>
<p><a href=""><img src="image-20221201184417858.png" srcset="/img/loading.gif" lazyload alt="image-20221201184417858"></a></p>
<p>创建ceshi和kaifa用户</p>
<p><a href=""><img src="image-20221201184535208.png" srcset="/img/loading.gif" lazyload alt="image-20221201184535208"></a></p>
<h5 id="6-4-7、关联使用系统用户的资产"><a href="#6-4-7、关联使用系统用户的资产" class="headerlink" title="6.4.7、关联使用系统用户的资产"></a>6.4.7、关联使用系统用户的资产</h5><p>将前面创建的系统用户推送到后端服务器并自动创建</p>
<p>在系统用户中添加使用此用户的资产</p>
<p><a href=""><img src="image-20221201184718588.png" srcset="/img/loading.gif" lazyload alt="image-20221201184718588"></a></p>
<p><a href=""><img src="image-20221201184932906.png" srcset="/img/loading.gif" lazyload alt="image-20221201184932906"></a></p>
<h5 id="6-4-8、创建授权规则"><a href="#6-4-8、创建授权规则" class="headerlink" title="6.4.8、创建授权规则"></a>6.4.8、创建授权规则</h5><p>通过授权规则, 为JumpServer用户分配可以访问的资产及使用的系统用户</p>
<p><a href=""><img src="image-20221201185653371.png" srcset="/img/loading.gif" lazyload alt="image-20221201185653371"></a></p>
<p>开发组授权</p>
<p><a href=""><img src="image-20221201185502685.png" srcset="/img/loading.gif" lazyload alt="image-20221201185502685"></a></p>
<p>测试组授权</p>
<p><a href=""><img src="image-20221201185607673.png" srcset="/img/loading.gif" lazyload alt="image-20221201185607673"></a></p>
<h5 id="6-4-9、测试登录访问后端服务器"><a href="#6-4-9、测试登录访问后端服务器" class="headerlink" title="6.4.9、测试登录访问后端服务器"></a>6.4.9、测试登录访问后端服务器</h5><p><a href=""><img src="image-20221201185948662.png" srcset="/img/loading.gif" lazyload alt="image-20221201185948662"></a></p>
<p>开发组xiaoming登录后端</p>
<p><a href=""><img src="image-20221201190140452.png" srcset="/img/loading.gif" lazyload alt="image-20221201190140452"></a></p>
<h5 id="6-4-9、ssh连接jumpserver"><a href="#6-4-9、ssh连接jumpserver" class="headerlink" title="6.4.9、ssh连接jumpserver"></a>6.4.9、ssh连接jumpserver</h5><p>JumpServer 还支持用户通过ssh连接其2222/tcp端口进行访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@Rocky ~]<span class="hljs-comment">#ssh -p2222 xiaoming@10.0.0.186    #10.0.0.186是搭建jumpserver的服务器 </span><br>		xiaoming,  JumpServer 开源堡垒机<br><br>	1) 输入 部分IP，主机名，备注 进行搜索登录(如果唯一).<br>	2) 输入 / + IP，主机名，备注 进行搜索，如：/192.168.<br>	3) 输入 p 进行显示您有权限的主机.<br>	4) 输入 g 进行显示您有权限的节点.<br>	5) 输入 d 进行显示您有权限的数据库.<br>	6) 输入 k 进行显示您有权限的Kubernetes.<br>	7) 输入 r 进行刷新最新的机器和节点信息.<br>	8) 输入 h 进行显示帮助.<br>	9) 输入 q 进行退出.<br>Opt&gt; <br></code></pre></td></tr></table></figure>

<h5 id="6-4-10、数据库授权"><a href="#6-4-10、数据库授权" class="headerlink" title="6.4.10、数据库授权"></a>6.4.10、数据库授权</h5><h6 id="6-4-10-1、在后端服务器创建数据库"><a href="#6-4-10-1、在后端服务器创建数据库" class="headerlink" title="6.4.10.1、在后端服务器创建数据库"></a>6.4.10.1、在后端服务器创建数据库</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@mysql ~]<span class="hljs-comment">#yum -y install mysql-server</span><br>[root@mysql ~]<span class="hljs-comment">#systemctl enable --now mysqld</span><br>Created symlink /etc/systemd/system/multi-user.target.wants/mysqld.service → /usr/lib/systemd/system/mys<br>[root@mysql ~]<span class="hljs-comment">#mysql</span><br>mysql&gt; create database wordpress;<br>mysql&gt; create user wordpress@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>mysql&gt; grant all on wordpress.* to wordpress@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h6 id="6-4-10-2、创建数据库应用"><a href="#6-4-10-2、创建数据库应用" class="headerlink" title="6.4.10.2、创建数据库应用"></a>6.4.10.2、创建数据库应用</h6><p>应用管理–数据库–创建</p>
<p><a href=""><img src="image-20221201193905625.png" srcset="/img/loading.gif" lazyload alt="image-20221201193905625"></a></p>
<h6 id="6-4-10-3、创建数据库的系统用户"><a href="#6-4-10-3、创建数据库的系统用户" class="headerlink" title="6.4.10.3、创建数据库的系统用户"></a>6.4.10.3、创建数据库的系统用户</h6><p>创建针对数据库的专用系统用户</p>
<p><strong>注意:协议选择mysql</strong></p>
<p><a href=""><img src="image-20221201194235233.png" srcset="/img/loading.gif" lazyload alt="image-20221201194235233"></a></p>
<p><a href=""><img src="image-20221201194506992.png" srcset="/img/loading.gif" lazyload alt="image-20221201194506992"></a></p>
<h6 id="6-4-10-4、创建数据库授权规则"><a href="#6-4-10-4、创建数据库授权规则" class="headerlink" title="6.4.10.4、创建数据库授权规则"></a>6.4.10.4、创建数据库授权规则</h6><p>权限管理–应用授权</p>
<p><a href=""><img src="image-20221201194825919.png" srcset="/img/loading.gif" lazyload alt="image-20221201194825919"></a></p>
<p>数据库授权给测试组使用</p>
<p><a href=""><img src="image-20221201195123403.png" srcset="/img/loading.gif" lazyload alt="image-20221201195123403"></a></p>
<h6 id="6-4-10-5、测试数据库连接"><a href="#6-4-10-5、测试数据库连接" class="headerlink" title="6.4.10.5、测试数据库连接"></a>6.4.10.5、测试数据库连接</h6><p><a href=""><img src="image-20221201195449263.png" srcset="/img/loading.gif" lazyload alt="image-20221201195449263"></a></p>
<h5 id="6-4-11、会话管理"><a href="#6-4-11、会话管理" class="headerlink" title="6.4.11、会话管理"></a>6.4.11、会话管理</h5><p>会话管理-命令记录、历史会话里面可以看到用户操作过并且已经退出的录像记录</p>
<p><strong>在线会话</strong></p>
<p><a href=""><img src="image-20221201195827167.png" srcset="/img/loading.gif" lazyload alt="image-20221201195827167"></a></p>
<p><strong>历史会话</strong></p>
<p><a href=""><img src="image-20221201200002381.png" srcset="/img/loading.gif" lazyload alt="image-20221201200002381"></a></p>
<h3 id="七、JVM垃圾回收原理，JVM调优。"><a href="#七、JVM垃圾回收原理，JVM调优。" class="headerlink" title="七、JVM垃圾回收原理，JVM调优。"></a>七、JVM垃圾回收原理，JVM调优。</h3><p><strong>对于垃圾回收,需要解决三个问题</strong></p>
<p>①哪些是垃圾要回收</p>
<p>②怎么回收垃圾</p>
<p>③什么时候回收垃圾</p>
<h4 id="7-1、确定垃圾的方法"><a href="#7-1、确定垃圾的方法" class="headerlink" title="7.1、确定垃圾的方法"></a>7.1、确定垃圾的方法</h4><p>①引用计数: 每一个堆内对象上都与一个私有引用计数器，记录着被引用的次数，引用计数清零，该对象所占用堆内存就可以被回收。循环引用的对象都无法将引用计数归零，就无法清除。Python中即使用此种方式</p>
<p>②根搜索(可达)算法 Root Searching</p>
<p><a href=""><img src="image-20221202091339692.png" srcset="/img/loading.gif" lazyload alt="image-20221202091339692"></a></p>
<h4 id="7-2、垃圾回收基本算法"><a href="#7-2、垃圾回收基本算法" class="headerlink" title="7.2、垃圾回收基本算法"></a>7.2、垃圾回收基本算法</h4><p><strong>方法一：标记-清除 Mark-Sweep</strong></p>
<p>分垃圾标记阶段和内存释放两个阶段。</p>
<p>①标记阶段，找到所有可访问对象打个标记。清理阶段，遍历整个堆</p>
<p>②对未标记对象(即不再使用的对象)逐一进行清理。</p>
<p><strong>特点：</strong></p>
<p>优点：算法简单</p>
<p>缺点：标记-清除最大的问题会造成<strong>内存碎片</strong>,但是不浪费空间,效率较高(如果对象较多时,逐一删除效率也会受到影响)</p>
<p><strong>方法二：标记-压缩 (压实)Mark-Compact</strong></p>
<p>分垃圾标记阶段和内存整理两个阶段。</p>
<p>①标记阶段，找到所有可访问对象打个标记。</p>
<p>②内存清理阶段时，整理时将对象向内存一端移动，整理后存活对象连续的集中在内存一端。</p>
<p><strong>特点：</strong></p>
<p>标记-压缩算法好处是整理后内存空间连续分配，有大段的连续内存可分配，没有内存碎片。</p>
<p>缺点是内存整理过程有消耗,效率相对低下</p>
<p><strong>方法三：复制Copying</strong></p>
<p>先将可用内存分为大小相同两块区域A和B，每次只用其中一块，比如A。当A用完后，则将A中存活的对象复制到B。复制到B的时候连续的使用内存，最后将A一次性清除干净。</p>
<p><strong>特点</strong>：</p>
<p>好处是没有碎片，复制过程中保证对象使用连续空间,且一次性清除所有垃圾,所以即使对象很多，收回效率也很高</p>
<p>缺点是比较浪费内存，只能使用原来一半内存，因为内存对半划分了，复制过程毕竟也是有代价。</p>
<p><strong>总结：</strong></p>
<p>没有最好的算法,在不同场景选择最合适的算法</p>
<p>①效率: 复制算法&gt;标记清除算法&gt; 标记压缩算法</p>
<p>②内存整齐度: 复制算法=标记压缩算法&gt; 标记清除算法</p>
<p>③内存利用率: 标记压缩算法=标记清除算法&gt;复制算法</p>
<h4 id="7-3、垃圾回收的原理"><a href="#7-3、垃圾回收的原理" class="headerlink" title="7.3、垃圾回收的原理"></a>7.3、垃圾回收的原理</h4><p><strong>分代堆内存GC策略：</strong>对不同数据进行区分管理，不同分区对数据实施不同回收策略，分而治之。</p>
<p><strong>堆内存分代</strong>将heap内存空间分为三个不同类别: <strong>年轻代、老年代、持久代</strong></p>
<p>①<strong>年轻代Young</strong>：Young Generation</p>
<p>​      ——<strong>伊甸园区eden</strong>: 只有一个,刚刚创建的对象</p>
<p>​      ——<strong>幸存(存活)区Servivor Space：</strong>有2个幸存区，一个是from区，一个是to区。大小相等、地位相同、可互换</p>
<p>​                   ——from 指的是本次复制数据的源区</p>
<p>​                   ——to 指的是本次复制数据的目标区</p>
<p>②<strong>老年代Tenured：</strong>Old Generation, 长时间存活的对象</p>
<p>**默认空间大小比例:**默认JVM试图分配最大内存的总内存的1/4,初始化默认总内存为总内存的1/64,年青代中heap的1/3，老年代占2/3</p>
<p><a href=""><img src="image-20221202093100290.png" srcset="/img/loading.gif" lazyload alt="image-20221202093100290"></a></p>
<p>③<strong>永久代：</strong>JDK1.7之前使用, 即Method Area方法区,保存JVM自身的类和方法,存储JAVA运行时的环境信息,JDK1.8后 改名为 MetaSpace,此空间不存在垃圾回收,关闭JVM会释放此区域内存,此空间物理上不属于heap内存,但逻辑上存在于heap内存</p>
<p>​      ——永久代必须指定大小限制,字符串常量JDK1.7存放在永久代,1.8后存放在heap中</p>
<p>​      ——MetaSpace 可以设置,也可不设置,无上限</p>
<p><strong>规律: 一般情况99%的对象都是临时对象</strong></p>
<h5 id="7-3-1、年轻代回收Minor-GC"><a href="#7-3-1、年轻代回收Minor-GC" class="headerlink" title="7.3.1、年轻代回收Minor GC"></a>7.3.1、年轻代回收Minor GC</h5><p>①起始时，所有新建对象(特大对象直接进入老年代)都出生在eden，当eden满了，<strong>启动GC</strong>。这个称</p>
<p>为<strong>Young GC</strong> 或者 <strong>Minor GC</strong>。 </p>
<p>②先<strong>标记</strong>eden存活对象，然后将存活对象<strong>复制</strong>到s0（假设本次是s0，也可以是s1，它们可以调</p>
<p>换），eden剩余所有空间都清空。<strong>GC完成</strong>。 </p>
<p>③继续新建对象，当eden再次满了，<strong>启动GC</strong>。 </p>
<p>④先同时<strong>标记</strong>eden和s0中存活对象，然后将存活对象<strong>复制</strong>到s1。将eden和s0清空,此次<strong>GC完成</strong></p>
<p>⑤继续新建对象，当eden满了，<strong>启动GC</strong>。 </p>
<p>⑥ 先<strong>标记</strong>eden和s1中存活对象，然后将存活对象<strong>复制</strong>到s0。将eden和s1清空,此次<strong>GC完成</strong></p>
<p>以后就重复上面的步骤。</p>
<p>通常场景下,大多数对象都不会存活很久，而且创建活动非常多，新生代就需要频繁垃圾回收。</p>
<p>但是，如果一个对象一直存活，它最后就在from、to来回复制，如果from区中对象复制次数达到阈值</p>
<p>(默认15次,CMS为6次,可通过java的选项 <strong>-XX:MaxTenuringThreshold=N</strong> 指定)，就直接复制到老年</p>
<p>代。</p>
<h5 id="7-3-2、老年代回收Major-GC"><a href="#7-3-2、老年代回收Major-GC" class="headerlink" title="7.3.2、老年代回收Major GC"></a>7.3.2、老年代回收Major GC</h5><p>进入老年代的数据较少，所以老年代区被占满的速度较慢，所以垃圾回收也不频繁。</p>
<p>如果老年代也满了,会触发老年代GC,称为<strong>Old GC</strong>或者 <strong>Major GC</strong>。</p>
<p>由于老年代对象一般来说存活次数较长，所以较常采用<strong>标记-压缩</strong>算法。</p>
<p>当老年代满时,会触发 <strong>Full GC</strong>,即对所有”代”的内存进行垃圾回收</p>
<p>Minor GC比较频繁，Major GC较少。但一般Major GC时，由于老年代对象也可以引用新生代对象，所</p>
<p>以先进行一次Minor GC，然后在Major GC会提高效率。可以认为回收老年代的时候完成了一次Full GC。</p>
<p>所以可以认为 <strong>MajorGC = FullGC</strong></p>
<h4 id="7-4、JVM参数的选项分类"><a href="#7-4、JVM参数的选项分类" class="headerlink" title="7.4、JVM参数的选项分类"></a>7.4、JVM参数的选项分类</h4><p>Java 命令行参考文档: <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></p>
<p><strong>选项分类</strong></p>
<p><strong>-选项名称</strong> 此为标准选项,所有HotSpot都支持</p>
<p><strong>-X选项名称</strong> 此为稳定的非标准选项</p>
<p><strong>-XX:选项名称</strong> 非标准的不稳定选项，下一个版本可能会取消</p>
<h4 id="7-5、jvm调优"><a href="#7-5、jvm调优" class="headerlink" title="7.5、jvm调优"></a>7.5、jvm调优</h4><p><strong>注意: 在不同领域和场景对JVM需要不同的调整策略</strong></p>
<p>减少 STW 时长，串行变并行</p>
<p>减少 GC 次数，要分配合适的内存大小</p>
<p><strong>一般情况下，大概可以使用以下原则：</strong></p>
<p>客户端或较小程序，内存使用量不大，可以使用串行回收</p>
<p>对于服务端大型计算，可以使用并行回收</p>
<p>大型WEB应用，用户端不愿意等待，尽量少的STW，可以使用并发回收</p>
<p><strong>①调整-Xms值和-Xmx值</strong></p>
<p>将-Xms值和-Xmx值设置为一样大小，避免内存不够用时来回申请</p>
<p>​         -Xms：设置应用程序<strong>初始</strong>使用的堆内存大小（年轻代+老年代）</p>
<p>​         -Xmx：设置应用程序能获得的<strong>最大</strong>堆内存；早期JVM不建议超过32G，内存管理效率下降 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#导入一个显示虚拟机（JVM）heap空间的java程序</span><br>[root@tomcat1 ~]<span class="hljs-comment">#ls</span><br>Heap.java<br>[root@tomcat1 ~]<span class="hljs-comment">#javac Heap.java </span><br>[root@tomcat1 ~]<span class="hljs-comment">#ls</span><br>Heap.class  Heap.java<br>[root@tomcat1 ~]<span class="hljs-comment">#java Heap</span><br>max=478150656字节	456.0MB               <span class="hljs-comment">#heap最大可使用空间</span><br>total=31457280字节	30.0MB            <span class="hljs-comment">#初始设置的heap空间</span><br>[root@tomcat1 ~]<span class="hljs-comment">#java -Xmx1g -Xms1g Heap</span><br>max=1073741824字节	1024.0MB<br>total=1073741824字节	1024.0MB<br></code></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#更改Tomcat的heap空间大小</span><br>[root@tomcat2 tomcat]<span class="hljs-comment">#vim bin/catalina.sh</span><br>JAVA_OPTS=<span class="hljs-string">&quot;-Xms4g -Xmx4g&quot;</span><br>:wq<br>[root@tomcat2 tomcat]<span class="hljs-comment">#systemctl restart tomcat</span><br><br>*************************************************************************<br><br>JAVA_OPTS=<span class="hljs-string">&quot;-server -Xms4g -Xmx4g -XX:NewSize= -XX:MaxNewSize= &quot;</span><br>-server：服务器模式<br>-Xms：堆内存初始化大小<br>-Xmx：堆内存空间上限<br>-XX:NewSize=：新生代空间初始化大小<br>-XX:MaxNewSize=：新生代空间最大值<br></code></pre></td></tr></table></figure>

<p>更改前heap大小</p>
<p><a href=""><img src="image-20221203124240190.png" srcset="/img/loading.gif" lazyload alt="image-20221203124240190"></a></p>
<p>更改后heap大小</p>
<p><a href=""><img src="image-20221203124653941.png" srcset="/img/loading.gif" lazyload alt="image-20221203124653941"></a></p>
<p><strong>②指定垃圾回收器的种类</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#查看java的垃圾回收器的种类</span><br>[root@tomcat1 tomcat]<span class="hljs-comment">#java -XX:+PrintCommandLineFlags -version</span><br>-XX:G1ConcRefinementThreads=2 -XX:GCDrainStackTargetSize=64 -XX:InitialHeapSize=29808512 -XX:MaxHeapSize=476936192 -XX:+PrintCommandLineFlags -XX:ReservedCodeCacheSize=251658240 -XX:+SegmentedCodeCache -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC<br><span class="hljs-comment">#-XX:+UseG1GC这是新版本的垃圾回收器，已经不分代了</span><br><br><span class="hljs-comment">#JVM 1.8 默认的垃圾回收器：PS + ParallelOld（高吞吐量，但交互式体验差）,所以大多数都是针对此进行调优，改成-XX:+UseConcMarkSweepGC垃圾回收器（交互式体验好）</span><br><span class="hljs-comment">#更改Tomcat的垃圾回收器</span><br>[root@tomcat2 tomcat]<span class="hljs-comment">#vim bin/catalina.sh</span><br>JAVA_OPTS=<span class="hljs-string">&quot;-Xms4g -Xmx4g -XX:+UseConcMarkSweepGC  -XX:+UseCMSCompactAtFullCollection -XX:CMSFullGCsBeforeCompaction=5&quot;</span><br>:wq<br>[root@tomcat2 tomcat]<span class="hljs-comment">#systemctl restart tomcat</span><br><br>**************************************************************************<br>-XX:+UseConcMarkSweepGC<br>     新生代使用ParNew, 老年代优先使用CMS，备选方式为Serial Old<br>     响应时间要短，停顿短使用这个垃圾收集器<br>     -XX:CMSInitiatingOccupancyFraction=N，N为0-100整数表示达到老年代的大小的百分比多少触发回收默认68<br>     -XX:+UseCMSCompactAtFullCollection 开启此值,在CMS收集后，进行内存碎片整理<br>     -XX:CMSFullGCsBeforeCompaction=N 设定多少次CMS后，进行一次内存碎片整理<br>     -XX:+CMSParallelRemarkEnabled 降低标记停顿<br></code></pre></td></tr></table></figure>

<p><strong>③线程池调整</strong></p>
<p>常用属性：</p>
<p>​        ①connectionTimeout ：连接超时时长,单位ms</p>
<p>​        ②maxThreads：最大线程数，默认200  </p>
<p>​        ③minSpareThreads：最小空闲线程数</p>
<p>​        ④maxSpareThreads：最大空闲线程数</p>
<p>​        ⑤acceptCount：当启动线程满了之后，等待队列的最大长度，默认100</p>
<p>​        ⑥URIEncoding：URI 地址编码格式，建议使用 UTF-8</p>
<p>​        ⑦enableLookups：是否启用客户端主机名的DNS反向解析，缺省禁用，建议禁用，就使用客户端IP就行</p>
<p>​        ⑧compression：是否启用传输压缩机制，建议 “on”，CPU和流量的平衡</p>
<p>​                    —compressionMinSize：启用压缩传输的数据流最小值，单位是字节</p>
<p>​                    —compressableMimeType：定义启用压缩功能的MIME类型text/html, text/xml, text/css,text/javascript</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#增大最大线程数，即增加可连接的客户数</span><br>[root@tomcat1 tomcat]<span class="hljs-comment">#vim /usr/local/tomcat/conf/server.xml</span><br>    &lt;Connector port=<span class="hljs-string">&quot;8080&quot;</span> protocol=<span class="hljs-string">&quot;HTTP/1.1&quot;</span><br>               connectionTimeout=<span class="hljs-string">&quot;20000&quot;</span><br>               redirectPort=<span class="hljs-string">&quot;8443&quot;</span> maxThreads=<span class="hljs-string">&quot;2000&quot;</span> /&gt;<br><span class="hljs-comment">#增加maxThreads=&quot;2000&quot;</span><br>:wq<br>[root@tomcat1 tomcat]<span class="hljs-comment">#systemctl restart tomcat</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221203133648027.png" srcset="/img/loading.gif" lazyload alt="image-20221203133648027"></a></p>
<h3 id="八、tomcat实现java应用发布。"><a href="#八、tomcat实现java应用发布。" class="headerlink" title="八、tomcat实现java应用发布。"></a>八、tomcat实现java应用发布。</h3><h4 id="8-1、部署基于JAVA的博客系统JPress"><a href="#8-1、部署基于JAVA的博客系统JPress" class="headerlink" title="8.1、部署基于JAVA的博客系统JPress"></a>8.1、部署基于JAVA的博客系统JPress</h4><p>官方网站：<a target="_blank" rel="noopener" href="http://www.jpress.io/">http://www.jpress.io/</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@Rocky ~]<span class="hljs-comment">#cd /usr/local/tomcat/webapps</span><br><span class="hljs-comment">#将jpress-v4.0.7.war放入此目录下自动解压缩生成jpress-v4.0.7（注意：需要在Tomcat启动下）</span><br>[root@Rocky webapps]<span class="hljs-comment">#ls</span><br>docs  examples  host-manager  jpress-v4.0.7  jpress-v4.0.7.war  manager  ROOT<br><span class="hljs-comment">#包的名字非常重要，此时访问ip:8080/jpress-v4.0.7非常不方便。所以最好在将war包放到此目录前更改名称，比如博客blog</span><br><br><span class="hljs-comment">#先将jpress-v4.0.7.war移走，jpress-v4.0.7自动消失</span><br>[root@Rocky webapps]<span class="hljs-comment">#mv jpress-v4.0.7.war  /opt</span><br>[root@Rocky webapps]<span class="hljs-comment">#ls</span><br>docs  examples  host-manager  manager  ROOT<br>[root@Rocky webapps]<span class="hljs-comment">#cd /opt</span><br>[root@Rocky opt]<span class="hljs-comment">#mv jpress-v4.0.7.war  /usr/local/tomcat/webapps/blog.war</span><br>[root@Rocky opt]<span class="hljs-comment">#cd -</span><br>/usr/local/tomcat/webapps<br>[root@Rocky webapps]<span class="hljs-comment">#ls</span><br>blog  blog.war  docs  examples  host-manager  manager  ROOT<br><span class="hljs-comment">#此时只需要输入ip:8080/blog即可访问了</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221202143633554.png" srcset="/img/loading.gif" lazyload alt="image-20221202143633554"></a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#准备数据库和用户授权</span><br>[root@Rocky webapps]<span class="hljs-comment">#yum -y install mysql-server ; systemctl enable --now mysqld</span><br>[root@Rocky webapps]<span class="hljs-comment">#mysql</span><br>mysql&gt; create database jpress;<br>mysql&gt; create user jpress@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;   <span class="hljs-comment">#因数据库安在本机，所以是localhost</span><br>mysql&gt; grant all on jpress.* to jpress@<span class="hljs-string">&#x27;localhost&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221202144619511.png" srcset="/img/loading.gif" lazyload alt="image-20221202144619511"></a></p>
<p><a href=""><img src="image-20221202144804984.png" srcset="/img/loading.gif" lazyload alt="image-20221202144804984"></a></p>
<p><a href=""><img src="image-20221202144839440.png" srcset="/img/loading.gif" lazyload alt="image-20221202144839440"></a></p>
<p><a href=""><img src="image-20221202144901645.png" srcset="/img/loading.gif" lazyload alt="image-20221202144901645"></a></p>
<p>此后输入10.0.0.186:8080/blog即可登录网页，但不是网站后端</p>
<p><a href=""><img src="image-20221202145157542.png" srcset="/img/loading.gif" lazyload alt="image-20221202145157542"></a></p>
<p>此后输入10.0.0.186:8080/blog/用户名即可登录网站后端</p>
<p><a href=""><img src="image-20221202145536310.png" srcset="/img/loading.gif" lazyload alt="image-20221202145536310"></a></p>
<h3 id="九、实现tomcat-session粘性，并验证过程。"><a href="#九、实现tomcat-session粘性，并验证过程。" class="headerlink" title="九、实现tomcat session粘性，并验证过程。"></a>九、实现tomcat session粘性，并验证过程。</h3><p><a href=""><img src="image-20221202184926676.png" srcset="/img/loading.gif" lazyload alt="image-20221202184926676"></a></p>
<h4 id="9-1、Tomcat配置"><a href="#9-1、Tomcat配置" class="headerlink" title="9.1、Tomcat配置"></a>9.1、Tomcat配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@tomcat1 ~]<span class="hljs-comment">#cd /usr/local/tomcat</span><br>[root@tomcat1 tomcat]<span class="hljs-comment">#vim conf/server.xml</span><br>&lt;Host name=<span class="hljs-string">&quot;www.magedu.org&quot;</span>  appBase=<span class="hljs-string">&quot;/data/tomcat/node1/&quot;</span><br>            unpackWARs=<span class="hljs-string">&quot;true&quot;</span> autoDeploy=<span class="hljs-string">&quot;true&quot;</span>&gt;<br>        &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> directory=<span class="hljs-string">&quot;logs&quot;</span><br>               prefix=<span class="hljs-string">&quot;node1_access_log&quot;</span> suffix=<span class="hljs-string">&quot;.txt&quot;</span><br>               pattern=<span class="hljs-string">&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot;</span> /&gt;<br>      &lt;/Host&gt;<br>:wq<br>[root@tomcat1 ~]<span class="hljs-comment">#mkdir -p /data/tomcat/node1/ROOT</span><br>[root@tomcat1 ~]<span class="hljs-comment">#cd /data/tomcat/node1/ROOT</span><br>[root@tomcat1 ROOT]<span class="hljs-comment">#vim index.jsp</span><br>[root@tomcat1 ROOT]<span class="hljs-comment">#cat index.jsp </span><br>&lt;%@ page import=<span class="hljs-string">&quot;java.util.*&quot;</span> %&gt;<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;tomcat <span class="hljs-built_in">test</span>&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt; Tomcat Website node1 &lt;/h1&gt;<br>&lt;div&gt;On  &lt;%=request.getServerName() %&gt;&lt;/div&gt;<br>&lt;div&gt;&lt;%=request.getLocalAddr() + <span class="hljs-string">&quot;:&quot;</span> + request.getLocalPort() %&gt;&lt;/div&gt;<br>&lt;div&gt;SessionID = &lt;span style=<span class="hljs-string">&quot;color:blue&quot;</span>&gt;&lt;%=session.getId() %&gt;&lt;/span&gt;&lt;/div&gt;<br>&lt;%=new Date()%&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>[root@tomcat1 ~]<span class="hljs-comment">#chown -R tomcat. /data/tomcat/node1/</span><br>[root@tomcat1 ROOT]<span class="hljs-comment">#systemctl restart tomcat</span><br>-----------------------------------------------------------------------------------<br>[root@tomcat2 ~]<span class="hljs-comment">#cd /usr/local/tomcat</span><br>[root@tomcat2 tomcat]<span class="hljs-comment">#vim conf/server.xml</span><br>&lt;Host name=<span class="hljs-string">&quot;www.magedu.org&quot;</span>  appBase=<span class="hljs-string">&quot;/data/tomcat/node2/&quot;</span><br>            unpackWARs=<span class="hljs-string">&quot;true&quot;</span> autoDeploy=<span class="hljs-string">&quot;true&quot;</span>&gt;<br>        &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> directory=<span class="hljs-string">&quot;logs&quot;</span><br>               prefix=<span class="hljs-string">&quot;node2_access_log&quot;</span> suffix=<span class="hljs-string">&quot;.txt&quot;</span><br>               pattern=<span class="hljs-string">&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot;</span> /&gt;<br>      &lt;/Host&gt;<br>:wq<br>[root@tomcat2 ~]<span class="hljs-comment">#mkdir -p /data/tomcat/node2/ROOT</span><br>[root@tomcat2 ~]<span class="hljs-comment">#cd /data/tomcat/node2/ROOT</span><br>[root@tomcat2 ROOT]<span class="hljs-comment">#vim index.jsp</span><br>[root@tomcat2 ROOT]<span class="hljs-comment">#cat index.jsp </span><br>&lt;%@ page import=<span class="hljs-string">&quot;java.util.*&quot;</span> %&gt;<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;tomcat <span class="hljs-built_in">test</span>&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt; Tomcat Website node2 &lt;/h1&gt;<br>&lt;div&gt;On  &lt;%=request.getServerName() %&gt;&lt;/div&gt;<br>&lt;div&gt;&lt;%=request.getLocalAddr() + <span class="hljs-string">&quot;:&quot;</span> + request.getLocalPort() %&gt;&lt;/div&gt;<br>&lt;div&gt;SessionID = &lt;span style=<span class="hljs-string">&quot;color:blue&quot;</span>&gt;&lt;%=session.getId() %&gt;&lt;/span&gt;&lt;/div&gt;<br>&lt;%=new Date()%&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>[root@tomcat2 ~]<span class="hljs-comment">#chown -R tomcat. /data/tomcat/node2/</span><br>[root@tomcat2 ROOT]<span class="hljs-comment">#systemctl restart tomcat</span><br></code></pre></td></tr></table></figure>

<h4 id="9-2、DNS解析"><a href="#9-2、DNS解析" class="headerlink" title="9.2、DNS解析"></a>9.2、DNS解析</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@DNS ~]<span class="hljs-comment">#vim /var/named/magedu.org.zone </span><br><span class="hljs-variable">$TTL</span> 1D<br>@         IN    SOA   master  admin.magedu.org ( 6  1D  10M  1D  6H  )<br>                NS    master<br>                NS    slave1<br>master          A     10.0.0.128<br>slave1          A     10.0.0.184<br>node1           A     10.0.0.216<br>node2           A     10.0.0.217 <br>:wq<br>[root@DNS ~]<span class="hljs-comment">#rndc reload</span><br></code></pre></td></tr></table></figure>

<h4 id="9-3、nginx的配置（反向代理与负载均衡）"><a href="#9-3、nginx的配置（反向代理与负载均衡）" class="headerlink" title="9.3、nginx的配置（反向代理与负载均衡）"></a>9.3、nginx的配置（反向代理与负载均衡）</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@nginx ~]<span class="hljs-comment">#vim /apps/nginx/conf/nginx.conf</span><br>http &#123;<br>    upstream tomcat &#123;                    <span class="hljs-comment">#添加此模块</span><br>        server 10.0.0.216:8080;<br>        server 10.0.0.217:8080;<br>    &#125;<br><br>    server &#123;<br>        listen       80;<br>        server_name  localhost;<br>        location / &#123;<br>            root   html;<br>            index  index.html index.htm;<br>            proxy_pass http://tomcat;      <span class="hljs-comment">#添加以下两行</span><br>            proxy_set_header Host <span class="hljs-variable">$http_host</span>;<br>        &#125;<br>    &#125;<br>&#125;<br>:wq<br>[root@nginx ~]<span class="hljs-comment">#systemctl restart nginx</span><br><span class="hljs-comment">#此时访问方式是轮询，但session一直发生变化</span><br></code></pre></td></tr></table></figure>

<h5 id="9-3-1、保持session不发生变化"><a href="#9-3-1、保持session不发生变化" class="headerlink" title="9.3.1、保持session不发生变化"></a>9.3.1、保持session不发生变化</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@nginx ~]<span class="hljs-comment">#vim /apps/nginx/conf/nginx.conf</span><br>    upstream tomcat &#123;<br>        <span class="hljs-built_in">hash</span> <span class="hljs-variable">$cookie_JSESSIONID</span>;       <span class="hljs-comment">#添加此行，当jsession相同时，就往同一台机器上调度</span><br>        server 10.0.0.216:8080;<br>        server 10.0.0.217:8080;<br>    &#125;<br>:wq<br>[root@nginx ~]<span class="hljs-comment">#systemctl restart nginx</span><br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221202185333822.png" srcset="/img/loading.gif" lazyload alt="image-20221202185333822"></a></p>
<p><a href=""><img src="image-20221202185406445.png" srcset="/img/loading.gif" lazyload alt="image-20221202185406445"></a></p>
<h3 id="十、实现tomcat会话复制集群。"><a href="#十、实现tomcat会话复制集群。" class="headerlink" title="十、实现tomcat会话复制集群。"></a>十、实现tomcat会话复制集群。</h3><p>Tomcat 官方实现了 Session 的复制集群,将每个Tomcat的Session进行相互的复制同步,从而保证所有Tomcat都有相同的Session信息.</p>
<p>10.1、配置说明</p>
<p>官方文档：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://tomcat.apache.org/tomcat-10.0-doc/cluster-howto.html https://tomcat.apache.org/tomcat-9.0-doc/cluster-howto.html https://tomcat.apache.org/tomcat-8.5-doc/cluster-howto.html<br></code></pre></td></tr></table></figure>

<p>说明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;Cluster className=<span class="hljs-string">&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;</span><br>         channelSendOptions=<span class="hljs-string">&quot;8&quot;</span>&gt;<br>         <br>  &lt;Manager className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.DeltaManager&quot;</span><br>           expireSessionsOnShutdown=<span class="hljs-string">&quot;false&quot;</span><br>           notifyListenersOnReplication=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br>           <br>  &lt;Channel className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.GroupChannel&quot;</span>&gt;<br>    &lt;Membership className=<span class="hljs-string">&quot;org.apache.catalina.tribes.membership.McastService&quot;</span><br>                address=<span class="hljs-string">&quot;228.0.0.4&quot;</span> <span class="hljs-comment">#每个集群的多播地址不同，范围224-239.x.x.x</span><br>                port=<span class="hljs-string">&quot;45564&quot;</span> <span class="hljs-comment">#45564/UDP</span><br>                frequency=<span class="hljs-string">&quot;500&quot;</span> <span class="hljs-comment">#间隔500ms发送</span><br>                dropTime=<span class="hljs-string">&quot;3000&quot;</span>/&gt; <span class="hljs-comment">#故障阈值3s</span><br>    &lt;Receiver className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.nio.NioReceiver&quot;</span><br>              address=<span class="hljs-string">&quot;auto&quot;</span> <span class="hljs-comment">#监听地址,此项建议修改为当前主机的IP</span><br>              port=<span class="hljs-string">&quot;4000&quot;</span> <span class="hljs-comment">#监听端口</span><br>              autoBind=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-comment">#如果端口冲突,自动绑定其它端口,范围是4000- 4100</span><br>              selectorTimeout=<span class="hljs-string">&quot;5000&quot;</span> <span class="hljs-comment">#自动绑定超时时长5s</span><br>              maxThreads=<span class="hljs-string">&quot;6&quot;</span>/&gt;<br>              <br>    &lt;Sender className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.ReplicationTransmitter&quot;</span>&gt;<br>    &lt;Transport className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.nio.PooledParallelSender&quot;</span>/&gt;    &lt;/Sender&gt;<br>&lt;Interceptor<br>className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.interceptors.TcpFailureDetector&quot;</span>/&gt;<br>&lt;Interceptor className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.interceptors.MessageDispatchIntercep tor&quot;</span>/&gt;<br>&lt;/Channel&gt;<br>  &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span> filter=<span class="hljs-string">&quot;&quot;</span>/&gt;<br>  &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.JvmRouteBinderValve&quot;</span>/&gt;<br>  <br>  &lt;Deployer className=<span class="hljs-string">&quot;org.apache.catalina.ha.deploy.FarmWarDeployer&quot;</span><br>            tempDir=<span class="hljs-string">&quot;/tmp/war-temp/&quot;</span><br>            deployDir=<span class="hljs-string">&quot;/tmp/war-deploy/&quot;</span><br>            watchDir=<span class="hljs-string">&quot;/tmp/war-listen/&quot;</span><br>            watchEnabled=<span class="hljs-string">&quot;false&quot;</span>/&gt;<br>            <br>  &lt;ClusterListener className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.ClusterSessionListener&quot;</span>/&gt;<br>&lt;/Cluster&gt;<br></code></pre></td></tr></table></figure>

<p><a href=""><img src="image-20221202192222020.png" srcset="/img/loading.gif" lazyload alt="image-20221202192222020"></a></p>
<h4 id="10-1、Tomcat配置"><a href="#10-1、Tomcat配置" class="headerlink" title="10.1、Tomcat配置"></a>10.1、Tomcat配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@tomcat1 ~]<span class="hljs-comment">#cd /usr/local/tomcat</span><br>[root@tomcat1 tomcat]<span class="hljs-comment">#vim conf/server.xml</span><br>&lt;Host name=<span class="hljs-string">&quot;www.magedu.org&quot;</span>  appBase=<span class="hljs-string">&quot;/data/tomcat/node1/&quot;</span><br>            unpackWARs=<span class="hljs-string">&quot;true&quot;</span> autoDeploy=<span class="hljs-string">&quot;true&quot;</span>&gt;<br>        &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> directory=<span class="hljs-string">&quot;logs&quot;</span><br>               prefix=<span class="hljs-string">&quot;node1_access_log&quot;</span> suffix=<span class="hljs-string">&quot;.txt&quot;</span><br>               pattern=<span class="hljs-string">&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot;</span> /&gt;<br><span class="hljs-comment">#下面的可以直接在官网了复制               </span><br>       &lt;Cluster className=<span class="hljs-string">&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;</span><br>                 channelSendOptions=<span class="hljs-string">&quot;8&quot;</span>&gt;<br><br>          &lt;Manager className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.DeltaManager&quot;</span><br>                   expireSessionsOnShutdown=<span class="hljs-string">&quot;false&quot;</span><br>                   notifyListenersOnReplication=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br><br>          &lt;Channel className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.GroupChannel&quot;</span>&gt;<br>            &lt;Membership className=<span class="hljs-string">&quot;org.apache.catalina.tribes.membership.McastService&quot;</span><br>                        address=<span class="hljs-string">&quot;228.0.0.4&quot;</span><br>                        port=<span class="hljs-string">&quot;45564&quot;</span><br>                        frequency=<span class="hljs-string">&quot;500&quot;</span><br>                        dropTime=<span class="hljs-string">&quot;3000&quot;</span>/&gt;<br>            &lt;Receiver className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.nio.NioReceiver&quot;</span><br>                      address=<span class="hljs-string">&quot;10.0.0.216&quot;</span><br>                      port=<span class="hljs-string">&quot;4000&quot;</span><br>                      autoBind=<span class="hljs-string">&quot;100&quot;</span><br>                      selectorTimeout=<span class="hljs-string">&quot;5000&quot;</span><br>                      maxThreads=<span class="hljs-string">&quot;6&quot;</span>/&gt;<br><br>            &lt;Sender className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.ReplicationTransmitter&quot;</span>&gt;<br>              &lt;Transport className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.nio.PooledParallelSender&quot;</span>/&gt;<br>            &lt;/Sender&gt;<br>            &lt;Interceptor className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.interceptors.TcpFailureDetector&quot;</span>/&gt;<br>            &lt;Interceptor className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.interceptors.MessageDispatchInterceptor&quot;</span>/&gt;<br>          &lt;/Channel&gt;<br><br>          &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span><br>                 filter=<span class="hljs-string">&quot;&quot;</span>/&gt;<br>          &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.JvmRouteBinderValve&quot;</span>/&gt;<br><br>          &lt;Deployer className=<span class="hljs-string">&quot;org.apache.catalina.ha.deploy.FarmWarDeployer&quot;</span><br>                    tempDir=<span class="hljs-string">&quot;/tmp/war-temp/&quot;</span><br>                    deployDir=<span class="hljs-string">&quot;/tmp/war-deploy/&quot;</span><br>                    watchDir=<span class="hljs-string">&quot;/tmp/war-listen/&quot;</span><br>                    watchEnabled=<span class="hljs-string">&quot;false&quot;</span>/&gt;<br><br>          &lt;ClusterListener className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.ClusterSessionListener&quot;</span>/&gt;<br>        &lt;/Cluster&gt;    <br><span class="hljs-comment">#官网复制的截止到上面一行</span><br>      &lt;/Host&gt;<br>:wq<br>[root@tomcat1 ~]<span class="hljs-comment">#mkdir -p /data/tomcat/node1/ROOT</span><br>[root@tomcat1 ~]<span class="hljs-comment">#cd /data/tomcat/node1/ROOT</span><br>[root@tomcat1 ROOT]<span class="hljs-comment">#vim index.jsp</span><br>[root@tomcat1 ROOT]<span class="hljs-comment">#cat index.jsp </span><br>&lt;%@ page import=<span class="hljs-string">&quot;java.util.*&quot;</span> %&gt;<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;tomcat <span class="hljs-built_in">test</span>&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt; Tomcat Website node1 &lt;/h1&gt;<br>&lt;div&gt;On  &lt;%=request.getServerName() %&gt;&lt;/div&gt;<br>&lt;div&gt;&lt;%=request.getLocalAddr() + <span class="hljs-string">&quot;:&quot;</span> + request.getLocalPort() %&gt;&lt;/div&gt;<br>&lt;div&gt;SessionID = &lt;span style=<span class="hljs-string">&quot;color:blue&quot;</span>&gt;&lt;%=session.getId() %&gt;&lt;/span&gt;&lt;/div&gt;<br>&lt;%=new Date()%&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>[root@tomcat1 ~]<span class="hljs-comment">#chown -R tomcat. /data/tomcat/node1/</span><br>[root@tomcat1 ~]<span class="hljs-comment">#cp -a /usr/local/tomcat/webapps/ROOT/WEB-INF/  /data/tomcat/node1/ROOT</span><br>[root@tomcat1 ~]<span class="hljs-comment">#vim /data/tomcat/node1/ROOT/WEB-INF/web.xml</span><br>&lt;distributable/&gt;          <span class="hljs-comment">#在倒数第二行添加此行</span><br>:wq<br>[root@tomcat1 ROOT]<span class="hljs-comment">#systemctl restart tomcat</span><br>-----------------------------------------------------------------------------------<br>[root@tomcat2 ~]<span class="hljs-comment">#cd /usr/local/tomcat</span><br>[root@tomcat2 tomcat]<span class="hljs-comment">#vim conf/server.xml</span><br>&lt;Host name=<span class="hljs-string">&quot;www.magedu.org&quot;</span>  appBase=<span class="hljs-string">&quot;/data/tomcat/node2/&quot;</span><br>            unpackWARs=<span class="hljs-string">&quot;true&quot;</span> autoDeploy=<span class="hljs-string">&quot;true&quot;</span>&gt;<br>        &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> directory=<span class="hljs-string">&quot;logs&quot;</span><br>               prefix=<span class="hljs-string">&quot;node2_access_log&quot;</span> suffix=<span class="hljs-string">&quot;.txt&quot;</span><br>               pattern=<span class="hljs-string">&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot;</span> /&gt;<br><span class="hljs-comment">#下面的可以直接在官网了复制               </span><br>       &lt;Cluster className=<span class="hljs-string">&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;</span><br>                 channelSendOptions=<span class="hljs-string">&quot;8&quot;</span>&gt;<br><br>          &lt;Manager className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.DeltaManager&quot;</span><br>                   expireSessionsOnShutdown=<span class="hljs-string">&quot;false&quot;</span><br>                   notifyListenersOnReplication=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br><br>          &lt;Channel className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.GroupChannel&quot;</span>&gt;<br>            &lt;Membership className=<span class="hljs-string">&quot;org.apache.catalina.tribes.membership.McastService&quot;</span><br>                        address=<span class="hljs-string">&quot;228.0.0.4&quot;</span><br>                        port=<span class="hljs-string">&quot;45564&quot;</span><br>                        frequency=<span class="hljs-string">&quot;500&quot;</span><br>                        dropTime=<span class="hljs-string">&quot;3000&quot;</span>/&gt;<br>            &lt;Receiver className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.nio.NioReceiver&quot;</span><br>                      address=<span class="hljs-string">&quot;10.0.0.216&quot;</span><br>                      port=<span class="hljs-string">&quot;4000&quot;</span><br>                      autoBind=<span class="hljs-string">&quot;100&quot;</span><br>                      selectorTimeout=<span class="hljs-string">&quot;5000&quot;</span><br>                      maxThreads=<span class="hljs-string">&quot;6&quot;</span>/&gt;<br><br>            &lt;Sender className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.ReplicationTransmitter&quot;</span>&gt;<br>              &lt;Transport className=<span class="hljs-string">&quot;org.apache.catalina.tribes.transport.nio.PooledParallelSender&quot;</span>/&gt;<br>            &lt;/Sender&gt;<br>            &lt;Interceptor className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.interceptors.TcpFailureDetector&quot;</span>/&gt;<br>            &lt;Interceptor className=<span class="hljs-string">&quot;org.apache.catalina.tribes.group.interceptors.MessageDispatchInterceptor&quot;</span>/&gt;<br>          &lt;/Channel&gt;<br><br>          &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span><br>                 filter=<span class="hljs-string">&quot;&quot;</span>/&gt;<br>          &lt;Valve className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.JvmRouteBinderValve&quot;</span>/&gt;<br><br>          &lt;Deployer className=<span class="hljs-string">&quot;org.apache.catalina.ha.deploy.FarmWarDeployer&quot;</span><br>                    tempDir=<span class="hljs-string">&quot;/tmp/war-temp/&quot;</span><br>                    deployDir=<span class="hljs-string">&quot;/tmp/war-deploy/&quot;</span><br>                    watchDir=<span class="hljs-string">&quot;/tmp/war-listen/&quot;</span><br>                    watchEnabled=<span class="hljs-string">&quot;false&quot;</span>/&gt;<br><br>          &lt;ClusterListener className=<span class="hljs-string">&quot;org.apache.catalina.ha.session.ClusterSessionListener&quot;</span>/&gt;<br>        &lt;/Cluster&gt;    <br><span class="hljs-comment">#官网复制的截止到上面一行      </span><br>      &lt;/Host&gt;<br>:wq<br>[root@tomcat2 ~]<span class="hljs-comment">#mkdir -p /data/tomcat/node2/ROOT</span><br>[root@tomcat2 ~]<span class="hljs-comment">#cd /data/tomcat/node2/ROOT</span><br>[root@tomcat2 ROOT]<span class="hljs-comment">#vim index.jsp</span><br>[root@tomcat2 ROOT]<span class="hljs-comment">#cat index.jsp </span><br>&lt;%@ page import=<span class="hljs-string">&quot;java.util.*&quot;</span> %&gt;<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;tomcat <span class="hljs-built_in">test</span>&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt; Tomcat Website node2 &lt;/h1&gt;<br>&lt;div&gt;On  &lt;%=request.getServerName() %&gt;&lt;/div&gt;<br>&lt;div&gt;&lt;%=request.getLocalAddr() + <span class="hljs-string">&quot;:&quot;</span> + request.getLocalPort() %&gt;&lt;/div&gt;<br>&lt;div&gt;SessionID = &lt;span style=<span class="hljs-string">&quot;color:blue&quot;</span>&gt;&lt;%=session.getId() %&gt;&lt;/span&gt;&lt;/div&gt;<br>&lt;%=new Date()%&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>[root@tomcat2 ~]<span class="hljs-comment">#chown -R tomcat. /data/tomcat/node2/</span><br>[root@tomcat2 ~]<span class="hljs-comment">#cp -a /usr/local/tomcat/webapps/ROOT/WEB-INF/  /data/tomcat/node2/ROOT</span><br>[root@tomcat2 ~]<span class="hljs-comment">#vim /data/tomcat/node2/ROOT/WEB-INF/web.xml</span><br>&lt;distributable/&gt;          <span class="hljs-comment">#在倒数第二行添加此行</span><br>:wq<br>[root@tomcat2 ROOT]<span class="hljs-comment">#systemctl restart tomcat</span><br></code></pre></td></tr></table></figure>

<h4 id="10-2、DNS解析"><a href="#10-2、DNS解析" class="headerlink" title="10.2、DNS解析"></a>10.2、DNS解析</h4><p>和上面9.2、DNS解析相同</p>
<h4 id="10-3、nginx的配置（反向代理与负载均衡）"><a href="#10-3、nginx的配置（反向代理与负载均衡）" class="headerlink" title="10.3、nginx的配置（反向代理与负载均衡）"></a>10.3、nginx的配置（反向代理与负载均衡）</h4><p>和上面9.3、nginx的配置（反向代理与负载均衡）相同</p>
<p><a href=""><img src="image-20221202194512169.png" srcset="/img/loading.gif" lazyload alt="image-20221202194512169"></a></p>
<p><a href=""><img src="image-20221202194551409.png" srcset="/img/loading.gif" lazyload alt="image-20221202194551409"></a></p>
<span id="more"></span>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/nginx-tomcat-jumpserver/">nginx  tomcat  jumpserver</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/11/27/Nginx%E7%BB%83%E4%B9%A0/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Nginx练习</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/11/07/%E7%AC%AC%E5%85%AB%E5%91%A8%E4%BD%9C%E4%B8%9A/">
                        <span class="hidden-mobile">第八周作业</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
